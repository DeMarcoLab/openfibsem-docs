
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the OpenFIBSEM Project">
      
      
      
      
        <link rel="prev" href="../installation/">
      
      
        <link rel="next" href="../user_guide/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44">
    
    
      
        <title>Concepts - OpenFIBSEM Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#concepts" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="OpenFIBSEM Documentation" class="md-header__button md-logo" aria-label="OpenFIBSEM Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OpenFIBSEM Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Concepts
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/DeMarcoLab/fibsem" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    DeMarcoLab/fibsem
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
    
  
  OpenFIBSEM

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  OpenFIBSEM API

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../autolamella/" class="md-tabs__link">
          
  
    
  
  AutoLamella

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../blog/" class="md-tabs__link">
          
  
    
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="OpenFIBSEM Documentation" class="md-nav__button md-logo" aria-label="OpenFIBSEM Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    OpenFIBSEM Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/DeMarcoLab/fibsem" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    DeMarcoLab/fibsem
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../.." class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    OpenFIBSEM
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            OpenFIBSEM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    OpenFIBSEM API
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            OpenFIBSEM API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Concepts
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Concepts
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#microscope-connection" class="md-nav__link">
    <span class="md-ellipsis">
      Microscope Connection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Microscope Connection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#microscope-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Microscope Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#turning-on-the-system" class="md-nav__link">
    <span class="md-ellipsis">
      Turning on the System
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#imaging" class="md-nav__link">
    <span class="md-ellipsis">
      Imaging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Imaging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#imaging-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Imaging Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acquiring-images" class="md-nav__link">
    <span class="md-ellipsis">
      Acquiring Images
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-metadata-fibsemimage" class="md-nav__link">
    <span class="md-ellipsis">
      Image Metadata (FibsemImage)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#save-load-fibsemimage" class="md-nav__link">
    <span class="md-ellipsis">
      Save / Load FibsemImage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Save / Load FibsemImage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chamber-camera" class="md-nav__link">
    <span class="md-ellipsis">
      Chamber Camera
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stage-movement" class="md-nav__link">
    <span class="md-ellipsis">
      Stage Movement
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Stage Movement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#movement-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Movement Concepts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#axes-and-coordinate-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Axes and Coordinate Systems
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shuttle-pre-tilt" class="md-nav__link">
    <span class="md-ellipsis">
      Shuttle Pre-Tilt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Shuttle Pre-Tilt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stage-positions" class="md-nav__link">
    <span class="md-ellipsis">
      Stage Positions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flat-to-beam" class="md-nav__link">
    <span class="md-ellipsis">
      Flat to Beam
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beam-coincidence" class="md-nav__link">
    <span class="md-ellipsis">
      Beam Coincidence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#microscope-state" class="md-nav__link">
    <span class="md-ellipsis">
      Microscope State
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#movement-axes-and-types" class="md-nav__link">
    <span class="md-ellipsis">
      Movement Axes and Types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Movement Axes and Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#relative-movement" class="md-nav__link">
    <span class="md-ellipsis">
      Relative Movement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#absolute-movement" class="md-nav__link">
    <span class="md-ellipsis">
      Absolute Movement
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stable-movement" class="md-nav__link">
    <span class="md-ellipsis">
      Stable Movement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vertical-movement" class="md-nav__link">
    <span class="md-ellipsis">
      Vertical Movement
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding-beam-coincidence" class="md-nav__link">
    <span class="md-ellipsis">
      Finding Beam Coincidence
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#milling" class="md-nav__link">
    <span class="md-ellipsis">
      Milling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manipulator" class="md-nav__link">
    <span class="md-ellipsis">
      Manipulator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manipulator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#axes-and-coordinate-systems_1" class="md-nav__link">
    <span class="md-ellipsis">
      Axes and Coordinate Systems
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Axes and Coordinate Systems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#raw-coordinate-system" class="md-nav__link">
    <span class="md-ellipsis">
      Raw Coordinate System
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corrected-movement-axes" class="md-nav__link">
    <span class="md-ellipsis">
      Corrected Movement Axes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manipulator-control" class="md-nav__link">
    <span class="md-ellipsis">
      Manipulator Control
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manipulator Control">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insert-manipulator" class="md-nav__link">
    <span class="md-ellipsis">
      Insert Manipulator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retract-manipulator" class="md-nav__link">
    <span class="md-ellipsis">
      Retract Manipulator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manipulator-movement" class="md-nav__link">
    <span class="md-ellipsis">
      Manipulator Movement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saved-positions" class="md-nav__link">
    <span class="md-ellipsis">
      Saved Positions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#offset-positions" class="md-nav__link">
    <span class="md-ellipsis">
      Offset Positions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manipulator-calibration" class="md-nav__link">
    <span class="md-ellipsis">
      Manipulator Calibration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manipulator Calibration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#thermo-fisher-easylift" class="md-nav__link">
    <span class="md-ellipsis">
      Thermo Fisher EasyLift
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tescan-calibration" class="md-nav__link">
    <span class="md-ellipsis">
      TESCAN Calibration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manipulator-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      Manipulator Preparation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manipulator-exchange" class="md-nav__link">
    <span class="md-ellipsis">
      Manipulator Exchange
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gas-injection-and-sputter-coater" class="md-nav__link">
    <span class="md-ellipsis">
      Gas Injection and Sputter Coater
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Gas Injection and Sputter Coater">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#specific-deposition" class="md-nav__link">
    <span class="md-ellipsis">
      Specific Deposition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cryogenic-deposition" class="md-nav__link">
    <span class="md-ellipsis">
      Cryogenic Deposition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sputter-coating" class="md-nav__link">
    <span class="md-ellipsis">
      Sputter Coating
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    <span class="md-ellipsis">
      Logging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Logging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#log-parsing" class="md-nav__link">
    <span class="md-ellipsis">
      Log Parsing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation" class="md-nav__link">
    <span class="md-ellipsis">
      Automation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Automation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alignment" class="md-nav__link">
    <span class="md-ellipsis">
      Alignment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-registration" class="md-nav__link">
    <span class="md-ellipsis">
      Image Registration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#segmentation-machine-learning" class="md-nav__link">
    <span class="md-ellipsis">
      Segmentation (Machine Learning)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#feature-detection" class="md-nav__link">
    <span class="md-ellipsis">
      Feature Detection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#objects-api" class="md-nav__link">
    <span class="md-ellipsis">
      Objects API
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#machine-learning-data-engine" class="md-nav__link">
    <span class="md-ellipsis">
      Machine Learning Data Engine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Machine Learning Data Engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-collection" class="md-nav__link">
    <span class="md-ellipsis">
      Data Collection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-curation" class="md-nav__link">
    <span class="md-ellipsis">
      Data Curation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-labelling" class="md-nav__link">
    <span class="md-ellipsis">
      Data Labelling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-labelling" class="md-nav__link">
    <span class="md-ellipsis">
      Manual Labelling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-assisted-labelling" class="md-nav__link">
    <span class="md-ellipsis">
      Model Assisted Labelling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#segmentanything-assisted-labelling" class="md-nav__link">
    <span class="md-ellipsis">
      SegmentAnything Assisted Labelling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-training" class="md-nav__link">
    <span class="md-ellipsis">
      Model Training
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Model Training">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-augmentation" class="md-nav__link">
    <span class="md-ellipsis">
      Data Augmentation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#losses-optimiser" class="md-nav__link">
    <span class="md-ellipsis">
      Losses, Optimiser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#training-the-model" class="md-nav__link">
    <span class="md-ellipsis">
      Training the Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-integration-nnunet" class="md-nav__link">
    <span class="md-ellipsis">
      External Integration - NNUnet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-integration-onnx" class="md-nav__link">
    <span class="md-ellipsis">
      External Integration - ONNX
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      Model Evaluation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keypoint-labelling" class="md-nav__link">
    <span class="md-ellipsis">
      Keypoint Labelling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keypoint-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      Keypoint Evaluation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      Model Deployment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-interface" class="md-nav__link">
    <span class="md-ellipsis">
      User Interface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-interface-controls" class="md-nav__link">
    <span class="md-ellipsis">
      User Interface Controls
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Interface Controls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#movement-controls" class="md-nav__link">
    <span class="md-ellipsis">
      Movement Controls
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keypoint-controls" class="md-nav__link">
    <span class="md-ellipsis">
      Keypoint Controls
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-interface-widgets" class="md-nav__link">
    <span class="md-ellipsis">
      User Interface Widgets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Interface Widgets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#microscope-connection-widget" class="md-nav__link">
    <span class="md-ellipsis">
      Microscope Connection Widget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#imaging-widget" class="md-nav__link">
    <span class="md-ellipsis">
      Imaging Widget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#movement-widget" class="md-nav__link">
    <span class="md-ellipsis">
      Movement Widget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#milling-widget" class="md-nav__link">
    <span class="md-ellipsis">
      Milling Widget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manipulator-widget" class="md-nav__link">
    <span class="md-ellipsis">
      Manipulator Widget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#feature-detection-widget" class="md-nav__link">
    <span class="md-ellipsis">
      Feature Detection Widget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#minimap-widget" class="md-nav__link">
    <span class="md-ellipsis">
      Minimap Widget
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-inferface-tools" class="md-nav__link">
    <span class="md-ellipsis">
      User Inferface Tools
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Inferface Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cryo-deposition" class="md-nav__link">
    <span class="md-ellipsis">
      Cryo Deposition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sputter-coating_1" class="md-nav__link">
    <span class="md-ellipsis">
      Sputter Coating
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manipulator-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Manipulator Tools
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#supervised-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Supervised Mode
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Supervised Mode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#feature-detection_1" class="md-nav__link">
    <span class="md-ellipsis">
      Feature Detection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#milling-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Milling Operations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional" class="md-nav__link">
    <span class="md-ellipsis">
      Additional
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#napari-plugins" class="md-nav__link">
    <span class="md-ellipsis">
      Napari Plugins
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user_guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../roadmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roadmap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../autolamella/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    AutoLamella
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            AutoLamella
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../autolamella/getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../autolamella/walkthrough/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Walkthrough
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../autolamella/motivation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Motivation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../autolamella/user_guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../autolamella/ml/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Machine Learning
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../blog/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#microscope-connection" class="md-nav__link">
    <span class="md-ellipsis">
      Microscope Connection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Microscope Connection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#microscope-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Microscope Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#turning-on-the-system" class="md-nav__link">
    <span class="md-ellipsis">
      Turning on the System
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#imaging" class="md-nav__link">
    <span class="md-ellipsis">
      Imaging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Imaging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#imaging-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Imaging Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acquiring-images" class="md-nav__link">
    <span class="md-ellipsis">
      Acquiring Images
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-metadata-fibsemimage" class="md-nav__link">
    <span class="md-ellipsis">
      Image Metadata (FibsemImage)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#save-load-fibsemimage" class="md-nav__link">
    <span class="md-ellipsis">
      Save / Load FibsemImage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Save / Load FibsemImage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chamber-camera" class="md-nav__link">
    <span class="md-ellipsis">
      Chamber Camera
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stage-movement" class="md-nav__link">
    <span class="md-ellipsis">
      Stage Movement
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Stage Movement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#movement-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Movement Concepts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#axes-and-coordinate-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Axes and Coordinate Systems
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shuttle-pre-tilt" class="md-nav__link">
    <span class="md-ellipsis">
      Shuttle Pre-Tilt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Shuttle Pre-Tilt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stage-positions" class="md-nav__link">
    <span class="md-ellipsis">
      Stage Positions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flat-to-beam" class="md-nav__link">
    <span class="md-ellipsis">
      Flat to Beam
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beam-coincidence" class="md-nav__link">
    <span class="md-ellipsis">
      Beam Coincidence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#microscope-state" class="md-nav__link">
    <span class="md-ellipsis">
      Microscope State
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#movement-axes-and-types" class="md-nav__link">
    <span class="md-ellipsis">
      Movement Axes and Types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Movement Axes and Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#relative-movement" class="md-nav__link">
    <span class="md-ellipsis">
      Relative Movement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#absolute-movement" class="md-nav__link">
    <span class="md-ellipsis">
      Absolute Movement
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stable-movement" class="md-nav__link">
    <span class="md-ellipsis">
      Stable Movement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vertical-movement" class="md-nav__link">
    <span class="md-ellipsis">
      Vertical Movement
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding-beam-coincidence" class="md-nav__link">
    <span class="md-ellipsis">
      Finding Beam Coincidence
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#milling" class="md-nav__link">
    <span class="md-ellipsis">
      Milling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manipulator" class="md-nav__link">
    <span class="md-ellipsis">
      Manipulator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manipulator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#axes-and-coordinate-systems_1" class="md-nav__link">
    <span class="md-ellipsis">
      Axes and Coordinate Systems
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Axes and Coordinate Systems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#raw-coordinate-system" class="md-nav__link">
    <span class="md-ellipsis">
      Raw Coordinate System
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corrected-movement-axes" class="md-nav__link">
    <span class="md-ellipsis">
      Corrected Movement Axes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manipulator-control" class="md-nav__link">
    <span class="md-ellipsis">
      Manipulator Control
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manipulator Control">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insert-manipulator" class="md-nav__link">
    <span class="md-ellipsis">
      Insert Manipulator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retract-manipulator" class="md-nav__link">
    <span class="md-ellipsis">
      Retract Manipulator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manipulator-movement" class="md-nav__link">
    <span class="md-ellipsis">
      Manipulator Movement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saved-positions" class="md-nav__link">
    <span class="md-ellipsis">
      Saved Positions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#offset-positions" class="md-nav__link">
    <span class="md-ellipsis">
      Offset Positions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manipulator-calibration" class="md-nav__link">
    <span class="md-ellipsis">
      Manipulator Calibration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manipulator Calibration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#thermo-fisher-easylift" class="md-nav__link">
    <span class="md-ellipsis">
      Thermo Fisher EasyLift
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tescan-calibration" class="md-nav__link">
    <span class="md-ellipsis">
      TESCAN Calibration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manipulator-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      Manipulator Preparation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manipulator-exchange" class="md-nav__link">
    <span class="md-ellipsis">
      Manipulator Exchange
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gas-injection-and-sputter-coater" class="md-nav__link">
    <span class="md-ellipsis">
      Gas Injection and Sputter Coater
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Gas Injection and Sputter Coater">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#specific-deposition" class="md-nav__link">
    <span class="md-ellipsis">
      Specific Deposition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cryogenic-deposition" class="md-nav__link">
    <span class="md-ellipsis">
      Cryogenic Deposition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sputter-coating" class="md-nav__link">
    <span class="md-ellipsis">
      Sputter Coating
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    <span class="md-ellipsis">
      Logging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Logging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#log-parsing" class="md-nav__link">
    <span class="md-ellipsis">
      Log Parsing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation" class="md-nav__link">
    <span class="md-ellipsis">
      Automation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Automation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alignment" class="md-nav__link">
    <span class="md-ellipsis">
      Alignment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-registration" class="md-nav__link">
    <span class="md-ellipsis">
      Image Registration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#segmentation-machine-learning" class="md-nav__link">
    <span class="md-ellipsis">
      Segmentation (Machine Learning)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#feature-detection" class="md-nav__link">
    <span class="md-ellipsis">
      Feature Detection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#objects-api" class="md-nav__link">
    <span class="md-ellipsis">
      Objects API
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#machine-learning-data-engine" class="md-nav__link">
    <span class="md-ellipsis">
      Machine Learning Data Engine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Machine Learning Data Engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-collection" class="md-nav__link">
    <span class="md-ellipsis">
      Data Collection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-curation" class="md-nav__link">
    <span class="md-ellipsis">
      Data Curation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-labelling" class="md-nav__link">
    <span class="md-ellipsis">
      Data Labelling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-labelling" class="md-nav__link">
    <span class="md-ellipsis">
      Manual Labelling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-assisted-labelling" class="md-nav__link">
    <span class="md-ellipsis">
      Model Assisted Labelling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#segmentanything-assisted-labelling" class="md-nav__link">
    <span class="md-ellipsis">
      SegmentAnything Assisted Labelling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-training" class="md-nav__link">
    <span class="md-ellipsis">
      Model Training
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Model Training">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-augmentation" class="md-nav__link">
    <span class="md-ellipsis">
      Data Augmentation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#losses-optimiser" class="md-nav__link">
    <span class="md-ellipsis">
      Losses, Optimiser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#training-the-model" class="md-nav__link">
    <span class="md-ellipsis">
      Training the Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-integration-nnunet" class="md-nav__link">
    <span class="md-ellipsis">
      External Integration - NNUnet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-integration-onnx" class="md-nav__link">
    <span class="md-ellipsis">
      External Integration - ONNX
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      Model Evaluation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keypoint-labelling" class="md-nav__link">
    <span class="md-ellipsis">
      Keypoint Labelling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keypoint-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      Keypoint Evaluation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      Model Deployment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-interface" class="md-nav__link">
    <span class="md-ellipsis">
      User Interface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-interface-controls" class="md-nav__link">
    <span class="md-ellipsis">
      User Interface Controls
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Interface Controls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#movement-controls" class="md-nav__link">
    <span class="md-ellipsis">
      Movement Controls
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keypoint-controls" class="md-nav__link">
    <span class="md-ellipsis">
      Keypoint Controls
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-interface-widgets" class="md-nav__link">
    <span class="md-ellipsis">
      User Interface Widgets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Interface Widgets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#microscope-connection-widget" class="md-nav__link">
    <span class="md-ellipsis">
      Microscope Connection Widget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#imaging-widget" class="md-nav__link">
    <span class="md-ellipsis">
      Imaging Widget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#movement-widget" class="md-nav__link">
    <span class="md-ellipsis">
      Movement Widget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#milling-widget" class="md-nav__link">
    <span class="md-ellipsis">
      Milling Widget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manipulator-widget" class="md-nav__link">
    <span class="md-ellipsis">
      Manipulator Widget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#feature-detection-widget" class="md-nav__link">
    <span class="md-ellipsis">
      Feature Detection Widget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#minimap-widget" class="md-nav__link">
    <span class="md-ellipsis">
      Minimap Widget
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-inferface-tools" class="md-nav__link">
    <span class="md-ellipsis">
      User Inferface Tools
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Inferface Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cryo-deposition" class="md-nav__link">
    <span class="md-ellipsis">
      Cryo Deposition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sputter-coating_1" class="md-nav__link">
    <span class="md-ellipsis">
      Sputter Coating
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manipulator-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Manipulator Tools
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#supervised-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Supervised Mode
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Supervised Mode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#feature-detection_1" class="md-nav__link">
    <span class="md-ellipsis">
      Feature Detection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#milling-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Milling Operations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional" class="md-nav__link">
    <span class="md-ellipsis">
      Additional
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#napari-plugins" class="md-nav__link">
    <span class="md-ellipsis">
      Napari Plugins
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="concepts">Concepts</h1>
<p>This page provides an overview of the OpenFIBSEM API and describes concepts and terminology used. </p>
<p>The code examples on this page are provided in a notebook: <a href="https://github.com/DeMarcoLab/openfibsem-docs/tree/main/notebooks">Github Repo</a></p>
<h2 id="microscope-connection">Microscope Connection</h2>
<p>OpenFIBSEM uses a client-server model for connecting to the microscope. The best way to connect to the microscope it to use the setup_session utility. This will handle reading the configuration file, setting up logging and connecting to the microscope. </p>
<p>It returns two items:</p>
<ul>
<li>microscope: the microscope connection  </li>
<li>settings:   the microscope settings</li>
</ul>
<p>The microscope connection is how we will communicate with the microscope, and will be passed to most funcitons. The microscope settings are a copy of the configuration settings, and contain the default imaging settings we will use in settings.image. </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># connecting to the microscope</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span> <span class="nn">fibsem</span> <span class="kn">import</span> <span class="n">utils</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1"># connect, setup session use default configuration</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">setup_session</span><span class="p">()</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="c1"># specify a configuration path</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">setup_session</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="s2">&quot;path/to/configuration.yaml&quot;</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="microscope-configuration">Microscope Configuration</h3>
<p>Before we can connect to the microscope, there are a few values we need to configure the microscope, and connection.  For details about configuring your microscope, please see the <a href="../getting_started/#configuring-your-microscope">Getting Started Page</a>.</p>
<p>If you used setup_session, your configuration is stored in the microscope connection as:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># microscope configuration</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">microscope</span><span class="o">.</span><span class="n">system</span>
</span></code></pre></div>
<p>By default, the configuration is not automatically applied to the microscope to prevent accidently changing settings when connecting. To apply the specified configuration, use the following command.</p>
<p>Please not that this might take some time, for example if you have specified a plasma gas this can take 10 minutes to change to a different gas. </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># apply current configuration</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">microscope</span><span class="o">.</span><span class="n">apply_configuration</span><span class="p">()</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="c1"># or specify a new configuration</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="n">microscope</span><span class="o">.</span><span class="n">apply_configuration</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">system</span><span class="p">)</span>
</span></code></pre></div>
<h2 id="turning-on-the-system">Turning on the System</h2>
<p>It is recommended to setup the system manually (e.g. pump the system, turn on the beams, focus and link the stage), but we also provide an api to do this. You will need to turn on the beams, and pump before you can apply the configuration. </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">from</span> <span class="nn">fibsem.structures</span> <span class="kn">import</span> <span class="n">BeamType</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="c1"># pump the system</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="n">microscope</span><span class="o">.</span><span class="n">pump</span><span class="p">()</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="c1"># turn on electron beam</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="n">microscope</span><span class="o">.</span><span class="n">turn_on</span><span class="p">(</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">)</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="c1"># turn on ion beam </span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="n">microscope</span><span class="o">.</span><span class="n">turn_on</span><span class="p">(</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">)</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="c1"># home the stage</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="n">microscope</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
</span></code></pre></div>
<p>You change get / set these properties and more through the get / set api:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># check if electron beam is on</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">electron_on</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">,</span> <span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">)</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Electron Beam: </span><span class="si">{</span><span class="n">electron_on</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="c1"># check chamber state</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="n">chamber_state</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chamber_state&quot;</span><span class="p">)</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chamber State: </span><span class="si">{</span><span class="n">chamber_state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="c1"># get column tilt of ion</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="n">ion_column_tilt</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;column_tilt&quot;</span><span class="p">,</span> <span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">)</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ion Column Tilt: </span><span class="si">{</span><span class="n">ion_column_tilt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nt">Electron Beam</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nt">Chamber State</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pumped</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="nt">Ion Column Tilt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">52</span>
</span></code></pre></div>
<h2 id="imaging">Imaging</h2>
<p>The imaging api is the core of the openfibsem api. It provides access to image acquistion, imaging parameters and tools. We currently support Electron and Ion Beam imaging.</p>
<h3 id="imaging-parameters">Imaging Parameters</h3>
<p>To control the imaging acquistion, we use the ImageSettings. The image settings you defined in configuration are attached to the microscope settings, for use and editing.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># print the image settings</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nb">print</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="c1"># change image settings</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">dwell_time</span> <span class="o">=</span> <span class="mf">2e-6</span>  <span class="c1"># set the dwell time to 2us</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="kc">True</span>        <span class="c1"># automatically save the image (note: this overwrite existing data, check the filename!!)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nd">@dataclass</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="k">class</span> <span class="nc">ImageSettings</span><span class="p">:</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A data class representing the settings for an image acquisition.&quot;&quot;&quot;</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    <span class="n">beam_type</span><span class="p">:</span> <span class="n">BeamType</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    <span class="n">resolution</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span>               <span class="c1"># imaging resolution      (pixels)</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    <span class="n">dwell_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>              <span class="c1"># imaging dwell time      (seconds)</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    <span class="n">hfw</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>                     <span class="c1"># imaging field of view   (metres )</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>    <span class="n">autocontrast</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>             <span class="c1"># use autocontrast method </span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>    <span class="n">autogamma</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>                <span class="c1"># use autogamma method</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>                     <span class="c1"># save the image</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>    <span class="n">path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>                     <span class="c1"># the save path           (directory)</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>                  <span class="c1"># the save filename       (str)</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>    <span class="n">reduced_area</span><span class="p">:</span> <span class="n">FibsemRectangle</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># sub frame imaging coords       </span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>    <span class="n">line_integration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>          <span class="c1"># integrate scan line     [TFS Only]</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>    <span class="n">scan_interlacing</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>          <span class="c1"># scan interlacing        [TFS Only]</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>    <span class="n">frame_integration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>         <span class="c1"># integrate frames        [TFS Only]</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>    <span class="n">drift_correction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>        <span class="c1"># req frame int           [TFS Only]</span>
</span></code></pre></div>
<h3 id="acquiring-images">Acquiring Images</h3>
<p>To acquire images, we use the acquire module:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kn">from</span> <span class="nn">fibsem</span> <span class="kn">import</span> <span class="n">acquire</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">plt</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="c1"># acquire image</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="n">eb_image</span> <span class="o">=</span> <span class="n">acquire</span><span class="o">.</span><span class="n">acquire_image</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="c1"># change settings, reacquire</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">hfw</span> <span class="o">=</span> <span class="mf">400e-6</span>             <span class="c1"># set the hfov to 400um</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">=</span> <span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span> <span class="c1"># set the imaging to ion beam</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="n">ib_image</span> <span class="o">=</span> <span class="n">acquire</span><span class="o">.</span><span class="n">acquire_image</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="c1"># plot</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">eb_image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Electron Beam&quot;</span><span class="p">)</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ib_image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Ion Beam&quot;</span><span class="p">)</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<h3 id="image-metadata-fibsemimage">Image Metadata (FibsemImage)</h3>
<p>When acquiring images, we also snapshot the state of the microscope. The state is stored in the metadata and can be accessed:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1">## Image Metadata</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="c1"># get the image settings used</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="n">image_settings</span> <span class="o">=</span> <span class="n">eb_image</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_settings</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Image Settings: </span><span class="si">{</span><span class="n">image_settings</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="c1"># access the stage position</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="n">stage_position</span> <span class="o">=</span> <span class="n">eb_image</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">microscope_state</span><span class="o">.</span><span class="n">stage_position</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stage Position: </span><span class="si">{</span><span class="n">stage_position</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="c1"># get the electron detector used for imaging</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="n">detector</span> <span class="o">=</span> <span class="n">eb_image</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">microscope_state</span><span class="o">.</span><span class="n">electron_detector</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Electron Detector: </span><span class="si">{</span><span class="n">detector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="c1"># pretty print the metadata (note: this is a lot of data)</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="n">pprint</span><span class="p">(</span><span class="n">eb_image</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
</span></code></pre></div>
<h2 id="save-load-fibsemimage">Save / Load FibsemImage</h2>
<p>You can save and load the images and metadata is retained. If you specify save=True in the imaging settings images will be automatically saved using the specified path and filename. Note: this save will automatically overwrite any existing image at that path/filename. Make sure you change this if you want to retain your data. </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kn">from</span> <span class="nn">fibsem.structures</span> <span class="kn">import</span> <span class="n">FibsemImage</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="c1"># save the image</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;data/test_electron_image.tif&quot;</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="n">eb_image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="c1"># load the image</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="n">loaded_image</span> <span class="o">=</span> <span class="n">FibsemImage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;metadata: </span><span class="si">{</span><span class="n">loaded_image</span><span class="o">.</span><span class="n">metadata</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="c1"># plot both</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">eb_image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Original Image&quot;</span><span class="p">)</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">loaded_image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Loaded Image&quot;</span><span class="p">)</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<h3 id="chamber-camera">Chamber Camera</h3>
<p>You can acquire an image from the chamber camera:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># acquire chamber image</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">image</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">acquire_chamber_image</span><span class="p">()</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<h2 id="stage-movement">Stage Movement</h2>
<p>The stage is the central movable system for the microscope, on which the sample is mounted. Most systems have 5 degrees of freedom (DoF); x, y, z, rotation, tilt. Some systems also have an additional tilt axis (roll axis, or tilt_beta).  </p>
<p>The sample is rigidly mounted onto the stage through the use of a sample holder (also called the shuttle), and the two move together. As far as I am aware, it is not possible to move the holder independently from the stage.</p>
<p><img alt="Stage Definitions" src="../assets/api/movement/stage_definitions.png" />
Stage Definitions</p>
<p>For cryo lamella preparation, the shuttle has a pre tilted face. This pre tilt is used to provide additional tilt than can be achieved by the stage alone. We will discuss the use of pre-tilted shuttles later. </p>
<p><img alt="Pre Tilted Shuttle" src="../assets/api/movement/pre_tilt_definitions.png" />
Pre-Tilted Shuttle</p>
<p>In general, we want to move along the sample plane (along the sample grid) while maintain coincidence between the beams. We also need to provide a method for correcting the coincidence, as it often drifts after large rotations etc. </p>
<h3 id="movement-concepts">Movement Concepts</h3>
<p>The following sections describe some core concepts, and terminology we use for the movement api. It is important to understand these terms for the next section.</p>
<h3 id="axes-and-coordinate-systems">Axes and Coordinate Systems</h3>
<p>When describing the stage axes and positions, we always use a raw coordinate system. This is the raw position of the stage defined from a static reference position (by the manufacturer). We do not use the linked (specimen) coordinate on Thermo Fisher system, but in order to access some functionality the system needs to be linked. You do not need to unlink the system to access the raw coordinates, it can remain linked and the api specifies the coordinates are to be raw. </p>
<p>Axes:</p>
<p>X+: Towards Door</p>
<p>Y+: Towards Load Position</p>
<p>Z+: UP</p>
<p><img alt="Stage Axes" src="../assets/api/movement/stage_movement_axes.png" />
Stage Movement Axes - Thermo Fisher</p>
<p>Depending on the manufacturer, the default stage axes may  be attached to the stage, or fixed in the chamber. For Thermo Fisher systems, the stage axes are attached to the stage, i.e. y-axis and z-axis tilts with stage tilt, while for Tescan it is not. Therefore, to provide consistent movement between systems we provide our own movement functions. </p>
<h3 id="shuttle-pre-tilt">Shuttle Pre-Tilt</h3>
<p>The shuttle pre-tilt adds additional complexity to stage movement, as the sample plane is now tilted relative to the stage axes. The following diagram shows how shuttle pre-tilt changes the sample plane. </p>
<p><img alt="Pre Tilt - Stage Flat" src="../assets/api/movement/pre_tilt_stage_flat.png" />
Stage Flat with Pre-Tiled Shuttle</p>
<p>We provide compensation for moving along the sample plane, and maintaining beam coincidence through the stable_move api. </p>
<h4 id="stage-positions">Stage Positions</h4>
<p>You can get and move to stage positions with the api. We also provide utils to save stage positions to file (.yaml) for restoration later. </p>
<p>By default these stage positions are saved to fibsem/config/positions.yaml, and are accessible through the user interface (Movement Tab).</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># get stage position</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">stage_position</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">get_stage_position</span><span class="p">()</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="c1"># go to stage position</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="n">microscope</span><span class="o">.</span><span class="n">safe_absolute_stage_movement</span><span class="p">(</span><span class="n">stage_position</span><span class="p">)</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="c1"># save stage position (saves to fibsem/config/positions.yaml by default, can be specified)</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="n">stage_position</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;my-position-01&quot;</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="n">utils</span><span class="o">.</span><span class="n">save_positions</span><span class="p">(</span><span class="n">stage_position</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="flat-to-beam">Flat to Beam</h4>
<p>It is common to move the stage so that the sample surface is perpendicular to the imaging axis of one of the beams. When the stage is in one of these positions, we refer to it as being 'Flat to the Beam', e.g. Flat to the Electron Beam.</p>
<p><img alt="Flat Shuttle Flat to Electron" src="../assets/api/movement/shuttle_flat_flat_electron.png" />
Flat to Electron - Flat Sample Holder</p>
<p><img alt="Pre-Tilt Flat to Ion" src="../assets/api/movement/shuttle_flat_flat_ion.png" />
Flat to Ion - Flat Sample Holder</p>
<p>To move to these positions, we require some information which is defined in the configuration:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nt">stage</span><span class="p">:</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">  </span><span class="nt">rotation_reference</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w">         </span><span class="c1"># the reference rotation (rotation when loading the stage usually)</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">  </span><span class="nt">rotation_180</span><span class="p">:</span><span class="w">       </span><span class="l l-Scalar l-Scalar-Plain">180</span><span class="w">       </span><span class="c1"># 180 degrees offset from rotation reference</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">  </span><span class="nt">shuttle_pre_tilt</span><span class="p">:</span><span class="w">   </span><span class="l l-Scalar l-Scalar-Plain">45</span><span class="w">        </span><span class="c1"># the pretilt of the shuttle</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="nt">electron</span><span class="p">:</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">  </span><span class="nt">column_tilt</span><span class="p">:</span><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w">         </span><span class="c1"># the tilt of the electron column</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="nt">ion</span><span class="p">:</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">  </span><span class="nt">column_tilt</span><span class="p">:</span><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">52</span><span class="w">        </span><span class="c1"># the tilt of the ion column</span>
</span></code></pre></div>
<p>In order to move flat to the beam, we need to adjust for the pre-tilt and column tilts, and specify which rotation reference to use. By definition, the electron beam uses the rotation reference, and the ion beam use the rotation 180. These values aren't always 0 / 180 and are determined by how the stage is physically mounted in the system.</p>
<p>Once these values are defined we can easily move flat to the beam as follows:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># NOTE: this will move from the current position, and only change rotation and tilt. It is recommended you move under the beam before hand.</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="c1"># move flat to the electron</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="n">microscope</span><span class="o">.</span><span class="n">move_flat_to_beam</span><span class="p">(</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">)</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="c1"># move flat to the ion</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="n">microscope</span><span class="o">.</span><span class="n">move_flat_to_beam</span><span class="p">(</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">)</span>
</span></code></pre></div>
<p><img alt="Pre-Tilt Flat to Electron" src="../assets/api/movement/pre_tilt_flat_electron.png" />
Flat to Electron - Shuttle Pre-Tilt</p>
<p><img alt="Pre-Tilt Flat to Ion" src="../assets/api/movement/pre_tilt_flat_ion.png" />
Flat to Ion - Shuttle Pre-Tilt</p>
<h4 id="beam-coincidence">Beam Coincidence</h4>
<p>Beam coincidence is defined as the positioning of the stage, such that both beams are centred on the same feature. We sometimes also discuss the eucentric position, which refers to being able to tilt the stage and have the feature stay centred in the image. </p>
<p>We can easily find the coincidence point for the system by using the following algorithm:</p>
<ol>
<li>Centre a Feature in the Electron Beam</li>
<li>Move the Stage vertically in the chamber, until the feature is also centred in the Ion Beam.</li>
</ol>
<p>The system is now at the coincidence point.</p>
<p>The difficult part of the algorithm is two fold:</p>
<ol>
<li>
<p>We need to detect the same feature in both beam. Detecting features automaticaly can be difficult, and their appearance can vary between beams due to imaging differences and perspective.</p>
</li>
<li>
<p>The standard stage axes move with the tilt of the stage, meaning it has to be compensated depending on the tilt, and pre-tilt.</p>
</li>
</ol>
<p>We provide a number of methods and tools for resolving these issues, which will be discussed shortly. </p>
<h4 id="microscope-state">Microscope State</h4>
<p>As described in the imaging section, we can snapshot the microscope state. This allows us to restore the state of the microscope at any point.</p>
<p>The state is defined as the stage position, and the beam and detector settings for both beams.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nd">@dataclass</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="k">class</span> <span class="nc">MicroscopeState</span><span class="p">:</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Data Class representing the state of a microscope with various parameters.&quot;&quot;&quot;</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span>                            <span class="c1"># timestamp of state</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>    <span class="n">stage_position</span><span class="p">:</span> <span class="n">FibsemStagePosition</span>         <span class="c1"># raw stage position</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>    <span class="n">electron_beam</span><span class="p">:</span> <span class="n">BeamSettings</span>                 <span class="c1"># electron beam settings</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>    <span class="n">ion_beam</span><span class="p">:</span> <span class="n">BeamSettings</span>                      <span class="c1"># ion beam settings</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>    <span class="n">electron_detector</span><span class="p">:</span> <span class="n">FibsemDetectorSettings</span>   <span class="c1"># electron detector settings</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>    <span class="n">ion_detector</span><span class="p">:</span> <span class="n">FibsemDetectorSettings</span>        <span class="c1"># ion detector settings</span>
</span></code></pre></div>
<p>You can get and restore the state as follows:
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># store microscope state</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="n">state</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">get_microscope_state</span><span class="p">()</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="c1"># restore microscope state</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="n">microscope</span><span class="o">.</span><span class="n">set_microscope_state</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span></code></pre></div></p>
<h4 id="movement-axes-and-types">Movement Axes and Types</h4>
<p>We provide the following movement modes, and describe their application.</p>
<h5 id="relative-movement">Relative Movement</h5>
<p>A relative movement, moves the stage by the specified amount in the raw coordinate system. This movement uses the manufacturers definition of the coordinate system. For example, for Thermo Fisher systems this moves in axes attached to the stage position.</p>
<p>If you are using ashuttle pre-tilt it is recommended to use stable movement instead.</p>
<h5 id="absolute-movement">Absolute Movement</h5>
<p>Absolute movement moves the stage to specified position in the raw coordinate system. It is used to return the stage to a previous position, or a projected position (based on a stable movement)</p>
<p>You can use absolute movements to return to previous positions with high accuracy. </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># get the initial position</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="n">start_position</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">get_stage_position</span><span class="p">()</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="c1"># relative move (dx=20e-6, y=20e-6)</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="n">stage_position</span> <span class="o">=</span> <span class="n">FibsemStagePosition</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">20e-6</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">20e-6</span><span class="p">)</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="n">microscope</span><span class="o">.</span><span class="n">move_stage_relative</span><span class="p">(</span><span class="n">stage_position</span><span class="p">)</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="c1"># absolute move</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="n">microscope</span><span class="o">.</span><span class="n">safe_absolute_stage_movement</span><span class="p">(</span><span class="n">stage_position</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="stable-movement">Stable Movement</h4>
<p>Stable movements move the stage along the sample plane. The primary use of stable movement is maintaining coincidence as you move across the sample. Stable moves correct for the stage tilt, shuttle pre-tilt and imaging perspective, and therefore you specify a beam to calculate the perspective from. </p>
<p>Once you find the coincidence point, you can use stable movements to move across the sample and maintain coincidence. This does degrade over larger distances, and we are working on making it more robust. </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># NOTE: it recommended that you make the beams coincident before this to see the effect</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="c1"># move flat to electron</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="n">microscope</span><span class="o">.</span><span class="n">move_flat_to_beam</span><span class="p">(</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">)</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="c1"># stable move</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="n">microscope</span><span class="o">.</span><span class="n">stable_move</span><span class="p">(</span><span class="n">dx</span><span class="o">=</span><span class="mf">20e-6</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mf">20e-6</span><span class="p">,</span> <span class="n">beam_type</span><span class="o">=</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">)</span>
</span></code></pre></div>
<p><img alt="Stable Movement - Flat to Electron" src="../assets/api/movement/stable_move_flat_electron.png" />
Stable Movement - Flat to Electron</p>
<p><img alt="Stable Movement - Flat to Ion" src="../assets/api/movement/stable_move_flat_ion.png" />
Stable Movement - Flat to Ion</p>
<h4 id="vertical-movement">Vertical Movement</h4>
<p>Vertical movements, move the stage vertically in the chamber, regardles of tilt. The primary use of vertical movement is to restore coincidence of the beams. As a result, vertical movements can only be specified from the Ion beam perspective. </p>
<p>You can use vertical movement in the user interface by holding 'Alt' and double clicking in the Ion Beam.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># vertical move</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="n">microscope</span><span class="o">.</span><span class="n">vertical_move</span><span class="p">(</span><span class="n">dx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mf">10e-6</span><span class="p">)</span>
</span></code></pre></div>
<p><img alt="Vertical Movement Flat to Electron" src="../assets/api/movement/vertical_move_flat_electron.png" />
Vertical Movement - Flat to Electron</p>
<p><img alt="Vertical Movement - Flat to Ion" src="../assets/api/movement/vertical_move_flat_ion.png" />
Vertical Movement - Flat to Ion</p>
<h3 id="finding-beam-coincidence">Finding Beam Coincidence</h3>
<p>Using stable and verical movements, we now have the basic procedure for setting the coincidence point manually in the user interface.</p>
<p>Assuming you have the user interface open, move the stage under the beams, and taken images with both beams:</p>
<ol>
<li>Double click in the Electron Beam on the feature you would like to centre. The stage will move to centre that features. This is a stable movement.</li>
<li>Hold 'Alt' and Double click in the Ion Beam on the same feature (note: if you can't see the same feature try increasing the hfw then re-image to see if its out of view). This is a vertical move. The feature should stay centred in the Electron beam, and the feature should move to the centre of the Ion.</li>
<li>You can now double click in either beam to move the stage and the system should stay relatively coincident. There will be some small degradation depending on sample quality / consistency. </li>
</ol>
<p><img alt="Stable Movement - Flat to Ion" src="../assets/api/movement/move_both_flat_ion.png" />
Finding Coincidence - Flat to Ion</p>
<p>You can repeat this any time you lose the coincidence. We use this same procedure with automated feature detection methods to automatically restore coincidence. Please see the <a href="#automation">Automation Section</a> for more information. </p>
<h2 id="milling">Milling</h2>
<p>Overview</p>
<p>Milling Patterns</p>
<p>Milling Parameters</p>
<p>Milling Stages and Protocols</p>
<p>Running Milling Operations</p>
<h2 id="manipulator">Manipulator</h2>
<p>The manipulator is an insertable system use for sample manipulation and transfer. It is most commonly used for liftout workflows to transfer a region of the sample to an external landing grid. Manipulators can be needles or grippers. We currently only support needle based manipulators, such as the TFS EasyLift. </p>
<h3 id="axes-and-coordinate-systems_1">Axes and Coordinate Systems</h3>
<p>Similar to the stage, the manipulator can have multiple coordinate systems. We use the Raw coordinate system to define the manipulator positions. </p>
<h4 id="raw-coordinate-system">Raw Coordinate System</h4>
<p>TODO: draw coordinate system axes</p>
<h4 id="corrected-movement-axes">Corrected Movement Axes</h4>
<p>We also provide a corrected manipulator movement api which allows for isolated axis movements. This allows you to move each axis of the manipulator when viewing from the image perspective. That is you can move the manipulator vertically in the Ion beam without moving it in the Electron. This is particular useful for automation routines.</p>
<p>axis: image direction (beam) desc
x+: right (both)
y+: up (electron)
z+: up (ion)      -&gt; moves manipulator towards the stage</p>
<p>TODO: draw coordinate system axes</p>
<h3 id="manipulator-control">Manipulator Control</h3>
<p>We provide the following methods for controlling the manipulator.</p>
<h4 id="insert-manipulator">Insert Manipulator</h4>
<p>To insert the manipulator</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># insert manipulator</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="kn">from</span> <span class="nn">fibsem</span> <span class="kn">import</span> <span class="n">utils</span><span class="p">,</span> <span class="n">acquire</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="kn">from</span> <span class="nn">fibsem.structures</span> <span class="kn">import</span> <span class="n">BeamType</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="c1"># NOTE: recommend that you move your stage flat + down before running this script</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="c1"># conect to microscope</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">setup_session</span><span class="p">()</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="c1"># insert manipulator</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="n">microscope</span><span class="o">.</span><span class="n">insert_manipulator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;PARK&quot;</span><span class="p">)</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="c1"># take reference images</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">hfw</span> <span class="o">=</span> <span class="mf">400e-6</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="n">eb_image</span><span class="p">,</span> <span class="n">ib_image</span> <span class="o">=</span> <span class="n">acquire</span><span class="o">.</span><span class="n">take_reference_images</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="c1"># plot</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">eb_image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ib_image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<h4 id="retract-manipulator">Retract Manipulator</h4>
<p>To retract the manipulator</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># retract manipulator</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">microscope</span><span class="o">.</span><span class="n">retract_manipulator</span><span class="p">()</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="c1"># take reference images</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">hfw</span> <span class="o">=</span> <span class="mf">400e-6</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="n">eb_image</span><span class="p">,</span> <span class="n">ib_image</span> <span class="o">=</span> <span class="n">acquire</span><span class="o">.</span><span class="n">take_reference_images</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="c1"># plot</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">eb_image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ib_image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<h4 id="manipulator-movement">Manipulator Movement</h4>
<p>It is recommended to use the corrected movements, as they will isolate the movements of the manipulator to in the imaging perspective. They are independent of stage tilt. </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># corrected manipulator movements</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="c1"># insert manipulator</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="n">microscope</span><span class="o">.</span><span class="n">insert_manipulator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;PARK&quot;</span><span class="p">)</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="c1"># take reference images</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">hfw</span> <span class="o">=</span> <span class="mf">400e-6</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="n">eb_image</span><span class="p">,</span> <span class="n">ib_image</span> <span class="o">=</span> <span class="n">acquire</span><span class="o">.</span><span class="n">take_reference_images</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="c1"># plot</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manipulator Inserted&quot;</span><span class="p">)</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">eb_image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ib_image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="c1"># move manipulator down (ION)</span>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="n">microscope</span><span class="o">.</span><span class="n">move_manipulator_corrected</span><span class="p">(</span><span class="n">dx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dy</span><span class="o">=-</span><span class="mf">20e-6</span><span class="p">,</span> <span class="n">beam_type</span><span class="o">=</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">)</span>
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a><span class="c1"># take reference images</span>
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a><span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">hfw</span> <span class="o">=</span> <span class="mf">400e-6</span>
</span><span id="__span-22-22"><a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a><span class="n">eb_image</span><span class="p">,</span> <span class="n">ib_image</span> <span class="o">=</span> <span class="n">acquire</span><span class="o">.</span><span class="n">take_reference_images</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-22-23"><a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a>
</span><span id="__span-22-24"><a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a><span class="c1"># plot</span>
</span><span id="__span-22-25"><a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="__span-22-26"><a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a><span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manipulator Moved (ION)&quot;</span><span class="p">)</span>
</span><span id="__span-22-27"><a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">eb_image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="__span-22-28"><a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ib_image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="__span-22-29"><a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="__span-22-30"><a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a>
</span><span id="__span-22-31"><a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a><span class="c1"># move manipulator in x, y (ELECTRON)</span>
</span><span id="__span-22-32"><a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a><span class="n">microscope</span><span class="o">.</span><span class="n">move_manipulator_corrected</span><span class="p">(</span><span class="n">dx</span><span class="o">=</span><span class="mf">10e-6</span><span class="p">,</span> <span class="n">dy</span><span class="o">=-</span><span class="mf">10e-6</span><span class="p">,</span> <span class="n">beam_type</span><span class="o">=</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">)</span>
</span><span id="__span-22-33"><a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a>
</span><span id="__span-22-34"><a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a><span class="c1"># take reference images</span>
</span><span id="__span-22-35"><a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a><span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">hfw</span> <span class="o">=</span> <span class="mf">400e-6</span>
</span><span id="__span-22-36"><a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a><span class="n">eb_image</span><span class="p">,</span> <span class="n">ib_image</span> <span class="o">=</span> <span class="n">acquire</span><span class="o">.</span><span class="n">take_reference_images</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-22-37"><a id="__codelineno-22-37" name="__codelineno-22-37" href="#__codelineno-22-37"></a>
</span><span id="__span-22-38"><a id="__codelineno-22-38" name="__codelineno-22-38" href="#__codelineno-22-38"></a><span class="c1"># plot</span>
</span><span id="__span-22-39"><a id="__codelineno-22-39" name="__codelineno-22-39" href="#__codelineno-22-39"></a><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="__span-22-40"><a id="__codelineno-22-40" name="__codelineno-22-40" href="#__codelineno-22-40"></a><span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manipulator Moved (ELECTRON)&quot;</span><span class="p">)</span>
</span><span id="__span-22-41"><a id="__codelineno-22-41" name="__codelineno-22-41" href="#__codelineno-22-41"></a><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">eb_image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="__span-22-42"><a id="__codelineno-22-42" name="__codelineno-22-42" href="#__codelineno-22-42"></a><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ib_image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="__span-22-43"><a id="__codelineno-22-43" name="__codelineno-22-43" href="#__codelineno-22-43"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<p>You can also use relative and absolute movements, but they are not recommended unless you know what you are doing. </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1"># relative move</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">position</span> <span class="o">=</span> <span class="n">FibsemManipulatorPosition</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">10e-6</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">10e-6</span><span class="p">)</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="n">microscope</span><span class="o">.</span><span class="n">move_manipulator_relative</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="c1"># absolute move</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="n">position</span> <span class="o">=</span> <span class="n">FibsemManipulatorPosition</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">10e-6</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">10e-6</span><span class="p">)</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="n">microscope</span><span class="o">.</span><span class="n">move_manipulator_absolute</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="saved-positions">Saved Positions</h4>
<p>When calibrating the manipulator, two positions are defined, PARK and EUCENTRIC. The PARK position is high above the sample (approx ~180um) and is the default insertion position. The EUCENTRIC position
is determined when you calibrate the manipulator. It should be when the manipulator is centred in the Electron Beam, and centred vertically in the Ion Beam. This is the best way to judge depth and where the manipulator will make contact with the sample.</p>
<p>You can access these saved positions:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># move to saved position (note: manipulator needs to be inserted beforehand)</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">position</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">_get_saved_manipulator_position</span><span class="p">(</span><span class="s2">&quot;PARK&quot;</span><span class="p">)</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="n">microscope</span><span class="o">.</span><span class="n">move_manipulator_absolute</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="offset-positions">Offset Positions</h4>
<p>You can also move to an offset from a named position. The offset is defined in the raw coordinates, i.e real manipulator position. The following code will insert the manipulator to 10um above the eucentric position. T  </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1"># move to offset position</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="kn">from</span> <span class="nn">fibsem.structures</span> <span class="kn">import</span> <span class="n">FibsemManipulatorPosition</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="c1"># set position offset</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="n">position_offset</span> <span class="o">=</span> <span class="n">FibsemManipulatorPosition</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="mf">10e-6</span><span class="p">,</span> <span class="n">coordinate_system</span><span class="o">=</span><span class="s2">&quot;RAW&quot;</span><span class="p">)</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="c1"># move manipulator to offset position (z=10e-6 above EUCENTRIC)</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="n">microscope</span><span class="o">.</span><span class="n">move_manipulator_to_position_offset</span><span class="p">(</span><span class="n">position_offset</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;EUCENTRIC&quot;</span><span class="p">)</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="c1"># take reference images</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">hfw</span> <span class="o">=</span> <span class="mf">150e-6</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="n">eb_image</span><span class="p">,</span> <span class="n">ib_image</span> <span class="o">=</span> <span class="n">acquire</span><span class="o">.</span><span class="n">take_reference_images</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="c1"># plot</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manipulator Moved To Offset&quot;</span><span class="p">)</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">eb_image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ib_image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<h3 id="manipulator-calibration">Manipulator Calibration</h3>
<p>There are two supported calibration tools; ThermoFisher and TESCAN</p>
<h5 id="thermo-fisher-easylift">Thermo Fisher EasyLift</h5>
<p>The manipulator calibration tool assists in calibrating the EasyLift. Due to API limitations, the user still has to activate the calibration procedure in xTUI and then can follow the instructions in the tool to calibrate their EasyLift each day.</p>
<p>You can also run this as a script using the following:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>python<span class="w"> </span>fibsem/tools/run_manipulator_calibration.py
</span></code></pre></div>
<h5 id="tescan-calibration">TESCAN Calibration</h5>
<p>The manipulator calibration tool will calibrate the TESCAN manipulator and map it to known coordinate systems. This allows it to follow the same convention used in the rest of the Manipulator API.</p>
<h4 id="manipulator-preparation">Manipulator Preparation</h4>
<p>Often, liftout methods require the preparation of the manipulator before use, e.g. attaching the copper adaptor for Serial Liftout. Manipulator preparation procedures are available in AutoLamella for both the liftout and serial-liftout methods. To use the procedures, open AutoLiftout UI, connect to the microscope, create an experiment and corresponding protocol. Then the preparation procedures are availle through the Tools -&gt; Manipulator Preparation menu. Please not that you should calibrate the manipulator before hand.  </p>
<h3 id="manipulator-exchange">Manipulator Exchange</h3>
<p>As the manipulator is used, it often becomes worn down through repeated milling or preparation. Eventually, it will become shortened and the motors will not have enough range to reach the sample. At this point, you need to exchange the manipulator. This can only be done when the system is vented, and will therefore required system downtime (especially for cryo operation). We do not currently have control over manipulator exchange, and it must be completed manually. The supported liftout method does not damage the manipulator and therefore it can be used for extended periods of time.  </p>
<h2 id="gas-injection-and-sputter-coater">Gas Injection and Sputter Coater</h2>
<p>Gas Injection Systems are a broad category of systems that are used for depositing material on the sample. We split these into three categories; specific deposition, cryo deposition and sputter coating.</p>
<h3 id="specific-deposition">Specific Deposition</h3>
<p>Specific deposition refers to using the using the beams to deposition in specific locations on the sample. A milling pattern is used to target and bake the area for deposition. </p>
<p>Currently, OpenFIBSEM does not support targeted deposition (i.e. ion beam deposition). We would like to add this in the future. If you would like us to prioritise this, please get in contact, or submit a pull request. This will involve some changes to the milling api first. </p>
<h3 id="cryogenic-deposition">Cryogenic Deposition</h3>
<p>In cryogenic conditions, it is not possible to specifically deposition as the material condenses immediately. Therefore, you can only deposition in a general way (i.e. over everything). </p>
<p>We support cryogenic deposition (i.e non-specific) deposition. You can also access the controls through the Cryo Deposition tool in AutoLamella (Tools -&gt; Cryo Deposition).</p>
<p>Note: The system we have tested this on uses a multi-chem, so it may not work correctly for non-multichem systems. If you have a standard gis and would like to test, please contact us. </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="kn">from</span> <span class="nn">fibsem</span> <span class="kn">import</span> <span class="n">gis</span><span class="p">,</span> <span class="n">utils</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="c1"># connect to microscope</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">setup_session</span><span class="p">()</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="c1"># save current position (optional)</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="n">position</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">get_stage_position</span><span class="p">()</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="n">position</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;cryo-deposition-grid-01&quot;</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="n">utils</span><span class="o">.</span><span class="n">save_positions</span><span class="p">([</span><span class="n">position</span><span class="p">])</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="c1"># example cryo deposition protocol</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="n">gis_protocol</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>    <span class="s2">&quot;application_file&quot;</span><span class="p">:</span> <span class="s2">&quot;cryo_Pt_dep&quot;</span><span class="p">,</span>          <span class="c1"># gis application file</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>    <span class="s2">&quot;gas&quot;</span><span class="p">:</span> <span class="s2">&quot;Pt cryo&quot;</span><span class="p">,</span>                           <span class="c1"># gis gas</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>    <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="s2">&quot;cryo&quot;</span><span class="p">,</span>                         <span class="c1"># gis position </span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>    <span class="s2">&quot;hfw&quot;</span><span class="p">:</span> <span class="mf">3.0e-05</span> <span class="p">,</span>                            <span class="c1"># image field width</span>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>    <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mf">7.0e-06</span><span class="p">,</span>                          <span class="c1"># pattern length</span>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a>    <span class="s2">&quot;beam_current&quot;</span><span class="p">:</span> <span class="mf">1.0e-8</span><span class="p">,</span>                     <span class="c1"># beam current</span>
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a>    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mf">30.0</span><span class="p">,</span>                               <span class="c1"># deposition time</span>
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a><span class="p">}</span>
</span><span id="__span-27-21"><a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a>
</span><span id="__span-27-22"><a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a><span class="c1"># run cryo deposition</span>
</span><span id="__span-27-23"><a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a><span class="n">gis</span><span class="o">.</span><span class="n">cryo_deposition</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> 
</span><span id="__span-27-24"><a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a>                    <span class="n">protocol</span><span class="o">=</span><span class="n">gis_protocol</span><span class="p">,</span> 
</span><span id="__span-27-25"><a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a>                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cryo-deposition-grid-01&quot;</span><span class="p">)</span>     <span class="c1"># specifying name is optional</span>
</span><span id="__span-27-26"><a id="__codelineno-27-26" name="__codelineno-27-26" href="#__codelineno-27-26"></a>                                                        <span class="c1"># if not specified, current position is used</span>
</span></code></pre></div>
<h3 id="sputter-coating">Sputter Coating</h3>
<p>Sputter coating refers to the integrated sputter coater (e.g. on the TFS Aquilos 2). It is usually a separate system than the standard GIS. </p>
<p>Currently, OpenFIBSEM does not support sputter coating. We would like to add this in the future, but do not have access to a system with it. If you would like us to prioritise this, and have a system we could use to test, please get in contact.  </p>
<h2 id="logging">Logging</h2>
<p>OpenFISBEM uses a structured event logging format. Operations are logged using a json format and can be parsed directly from the log file. By default, logs are saved in the session directory in logfile.log. For AutoLamella applications, logs are saved inside the Experiment directory in the logfile.log.  </p>
<h3 id="log-parsing">Log Parsing</h3>
<p>AutoLamella contains a log parser for extracting statistical information from the logs, and a explorer application for analysing data. You could also use other log parsers to export this data. </p>
<p>Log Parser:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>autolamella/tools/data.py
</span></code></pre></div>
<p>To run the explorer app:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>streamlit<span class="w"> </span>run<span class="w"> </span>autolamella/tools/stats.py
</span></code></pre></div>
<h2 id="automation">Automation</h2>
<h3 id="alignment">Alignment</h3>
<h3 id="image-registration">Image Registration</h3>
<h3 id="segmentation-machine-learning">Segmentation (Machine Learning)</h3>
<p>We provide a standardised segmentation model interface, for loading models, running inference and visualisation.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="kn">from</span> <span class="nn">fibsem.segmentation.model</span> <span class="kn">import</span> <span class="n">load_model</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="kn">from</span> <span class="nn">fibsem.segmentation.utils</span> <span class="kn">import</span> <span class="n">plot_segmentations</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="kn">from</span> <span class="nn">fibsem.structures</span> <span class="kn">import</span> <span class="n">FibsemImage</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="c1"># load model</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;autolamella-mega-20240107.pt&quot;</span><span class="p">)</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="c1"># load image (or acquire from microscope)</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="n">image</span> <span class="o">=</span> <span class="n">FibsemImage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/test_image.tif&quot;</span><span class="p">)</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="c1"># model inference (rgb = True to auto convert to rgb)</span>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="n">mask</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">rgb</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a><span class="c1"># plot segmentation</span>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a><span class="n">fig</span> <span class="o">=</span> <span class="n">plot_segmentations</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span></code></pre></div>
<p><img alt="Example Segmentation" src="../assets/api/segmentation/example_segmentation01.png" /></p>
<p>You can also plot multiple segmentations at once.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="kn">from</span> <span class="nn">fibsem.segmentation.model</span> <span class="kn">import</span> <span class="n">load_model</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="kn">from</span> <span class="nn">fibsem.structures</span> <span class="kn">import</span> <span class="n">FibsemImage</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="kn">from</span> <span class="nn">fibsem.segmentation.utils</span> <span class="kn">import</span> <span class="n">plot_segmentations</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="kn">import</span> <span class="nn">glob</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="c1"># load model</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;autolamella-serial-liftout-20240107.pt&quot;</span><span class="p">)</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="c1"># load data</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="n">filenames</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;data/example/0*.tif&quot;</span><span class="p">))</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="n">masks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">FibsemImage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a>
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">rgb</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a>
</span><span id="__span-31-21"><a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a>    <span class="n">masks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
</span><span id="__span-31-22"><a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a>    <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-31-23"><a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a>
</span><span id="__span-31-24"><a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a><span class="n">fig</span> <span class="o">=</span> <span class="n">plot_segmentations</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">masks</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span></code></pre></div>
<p><img alt="Example Segmentation" src="../assets/api/segmentation/example_segmentation02.png" /></p>
<h3 id="feature-detection">Feature Detection</h3>
<p>We support a standardised feature detection interface. All standardised features are implemented as an abstract base class Feature, with standard properties and interfaces (.name, .color, .detect())</p>
<div class="language-python highlight"><span class="filename">fibsem/detection/detection.py</span><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="nd">@dataclass</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="k">class</span> <span class="nc">Feature</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>    <span class="n">px</span><span class="p">:</span> <span class="n">Point</span>                 <span class="c1"># the position of the feature in the image (pixels, image frame)</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>    <span class="n">feature_m</span><span class="p">:</span> <span class="n">Point</span>          <span class="c1"># the position of the feature in the image (metres, microscope frame)</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>    <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span>           <span class="c1"># the display color </span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>          <span class="c1"># the display name </span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>    <span class="n">class_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>      <span class="c1"># the class id    (ml based features only)</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>    <span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>    <span class="c1"># the class name  (ml based features only)</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>    <span class="nd">@abstractmethod</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>    <span class="k">def</span> <span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span><span class="n">Point</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Feature&#39;</span><span class="p">:</span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>        <span class="k">pass</span>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-32-16"><a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="__span-32-17"><a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a>            <span class="s2">&quot;px&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">px</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
</span><span id="__span-32-18"><a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a>            <span class="s2">&quot;feature_m&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_m</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="__span-32-19"><a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a>        <span class="p">}</span>
</span></code></pre></div>
<p>This interface allows features to implement their own detect method, which can be as simple or as complex as needs be, while allowing them to be used with all the other tools. </p>
<div class="language-python highlight"><span class="filename">fibsem/detection/detection.py</span><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1">## A simple feature for returning the centre of the image</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="nd">@dataclass</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="k">class</span> <span class="nc">ImageCentre</span><span class="p">(</span><span class="n">Feature</span><span class="p">):</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>    <span class="n">feature_m</span><span class="p">:</span> <span class="n">Point</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>    <span class="n">px</span><span class="p">:</span> <span class="n">Point</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>    <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ImageCentre&quot;</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>    <span class="k">def</span> <span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span><span class="n">Point</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ImageCentre&#39;</span><span class="p">:</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">px</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">px</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="c1">## A more complicated feature for detecting the tip of the manipulator, using a custom detect method</span>
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="nd">@dataclass</span>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="k">class</span> <span class="nc">NeedleTip</span><span class="p">(</span><span class="n">Feature</span><span class="p">):</span>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a>    <span class="n">feature_m</span><span class="p">:</span> <span class="n">Point</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a>    <span class="n">px</span><span class="p">:</span> <span class="n">Point</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a>    <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span>
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;NeedleTip&quot;</span>
</span><span id="__span-33-21"><a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a>    <span class="n">class_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="__span-33-22"><a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a>    <span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;manipulator&quot;</span>
</span><span id="__span-33-23"><a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a>
</span><span id="__span-33-24"><a id="__codelineno-33-24" name="__codelineno-33-24" href="#__codelineno-33-24"></a>    <span class="k">def</span> <span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span><span class="n">Point</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;NeedleTip&#39;</span><span class="p">:</span>
</span><span id="__span-33-25"><a id="__codelineno-33-25" name="__codelineno-33-25" href="#__codelineno-33-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">px</span> <span class="o">=</span> <span class="n">detect_needle_v5</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">class_id</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
</span><span id="__span-33-26"><a id="__codelineno-33-26" name="__codelineno-33-26" href="#__codelineno-33-26"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">px</span>
</span><span id="__span-33-27"><a id="__codelineno-33-27" name="__codelineno-33-27" href="#__codelineno-33-27"></a>
</span><span id="__span-33-28"><a id="__codelineno-33-28" name="__codelineno-33-28" href="#__codelineno-33-28"></a><span class="c1"># detect method</span>
</span><span id="__span-33-29"><a id="__codelineno-33-29" name="__codelineno-33-29" href="#__codelineno-33-29"></a><span class="k">def</span> <span class="nf">detect_needle_v5</span><span class="p">(</span><span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">edge</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
</span><span id="__span-33-30"><a id="__codelineno-33-30" name="__codelineno-33-30" href="#__codelineno-33-30"></a>    <span class="n">needle_mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">==</span> <span class="n">idx</span>
</span><span id="__span-33-31"><a id="__codelineno-33-31" name="__codelineno-33-31" href="#__codelineno-33-31"></a>    <span class="k">return</span> <span class="n">detect_absolute_edge</span><span class="p">(</span><span class="n">needle_mask</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="n">edge</span><span class="p">,</span> 
</span><span id="__span-33-32"><a id="__codelineno-33-32" name="__codelineno-33-32" href="#__codelineno-33-32"></a>        <span class="n">_filter</span><span class="o">=</span><span class="s2">&quot;largest&quot;</span><span class="p">,</span> <span class="n">_mode</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
</span></code></pre></div>
<p>The list of available features is accessible here:</p>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="kn">from</span> <span class="nn">fibsem.detection</span> <span class="kn">import</span> <span class="n">detection</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="nb">print</span><span class="p">(</span><span class="n">detection</span><span class="o">.</span><span class="n">__FEATURES__</span><span class="p">)</span>
</span></code></pre></div>
We use the following api to detect features, and return them in a standard format. We also provide utilities for plotting. </p>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kn">from</span> <span class="nn">fibsem.detection</span> <span class="kn">import</span> <span class="n">detection</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="kn">from</span> <span class="nn">fibsem.segmentation.model</span> <span class="kn">import</span> <span class="n">load_model</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="kn">from</span> <span class="nn">fibsem.structures</span> <span class="kn">import</span> <span class="n">FibsemImage</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="kn">from</span> <span class="nn">fibsem.detection.detection</span> <span class="kn">import</span> <span class="n">DetectedFeatures</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="c1"># load model</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;autolamella-mega-20240107.pt&quot;</span><span class="p">)</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="c1"># load image (or acquire from microscope)</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="n">image</span> <span class="o">=</span> <span class="n">FibsemImage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;test_image.tif&quot;</span><span class="p">)</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="c1"># detect features (also runs segmentation inference)</span>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="n">det</span><span class="p">:</span> <span class="n">DetectedFeatures</span> <span class="o">=</span> <span class="n">detection</span><span class="o">.</span><span class="n">detect_features</span><span class="p">(</span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a>    <span class="n">image</span><span class="o">=</span> <span class="n">image</span><span class="p">,</span> 
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a>    <span class="n">model</span><span class="o">=</span> <span class="n">model</span><span class="p">,</span> 
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a>    <span class="n">features</span> <span class="o">=</span> <span class="n">features</span>
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a>    <span class="n">pixelsize</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">pixelsize</span>
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a>    <span class="nb">filter</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a>    <span class="n">point</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a><span class="p">)</span>
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a>
</span><span id="__span-35-23"><a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a><span class="c1"># plot detections</span>
</span><span id="__span-35-24"><a id="__codelineno-35-24" name="__codelineno-35-24" href="#__codelineno-35-24"></a><span class="n">fig</span> <span class="o">=</span> <span class="n">detection</span><span class="o">.</span><span class="n">plot_detection</span><span class="p">(</span><span class="n">det</span><span class="p">)</span>
</span></code></pre></div>
<img alt="Feature Detection Example" src="../assets/api/feature_detection/example_feature_detection.png" />
Feature Detection Example</p>
<div class="language-python highlight"><span class="filename">fibsem/detection/detection.py</span><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="nd">@dataclass</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="k">class</span> <span class="nc">DetectedFeatures</span><span class="p">:</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>    <span class="n">features</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Feature</span><span class="p">]</span>             <span class="c1"># list of detected features</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>    <span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>                   <span class="c1"># image data</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>    <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>                    <span class="c1"># class binary mask</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>    <span class="n">rgb</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>                     <span class="c1"># rgb mask</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>    <span class="n">pixelsize</span><span class="p">:</span> <span class="nb">float</span>                    <span class="c1"># image pixelsize</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>    <span class="n">_distance</span><span class="p">:</span> <span class="n">Point</span> <span class="o">=</span> <span class="kc">None</span>             <span class="c1"># distance between the first two features</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a>    <span class="n">_offset</span><span class="p">:</span> <span class="n">Point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>        <span class="c1"># offset applied to distance</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>    <span class="n">fibsem_image</span><span class="p">:</span> <span class="n">FibsemImage</span> <span class="o">=</span> <span class="kc">None</span>    <span class="c1"># the fibsem image </span>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>    <span class="n">checkpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>              <span class="c1"># model checkpoint </span>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a>
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a>    <span class="nd">@property</span>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a>    <span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Need at least two features to calculate distance&quot;</span>
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">px</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">px</span><span class="p">)</span><span class="o">.</span><span class="n">_to_metres</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span>        
</span><span id="__span-36-17"><a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a>
</span><span id="__span-36-18"><a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a>    <span class="nd">@distance</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-36-19"><a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a>    <span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-36-20"><a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_distance</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-36-21"><a id="__codelineno-36-21" name="__codelineno-36-21" href="#__codelineno-36-21"></a>
</span><span id="__span-36-22"><a id="__codelineno-36-22" name="__codelineno-36-22" href="#__codelineno-36-22"></a>    <span class="k">def</span> <span class="nf">get_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ftype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Feature</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Feature</span><span class="p">:</span>
</span><span id="__span-36-23"><a id="__codelineno-36-23" name="__codelineno-36-23" href="#__codelineno-36-23"></a>        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
</span><span id="__span-36-24"><a id="__codelineno-36-24" name="__codelineno-36-24" href="#__codelineno-36-24"></a>            <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">ftype</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">ftype</span><span class="p">)):</span>
</span><span id="__span-36-25"><a id="__codelineno-36-25" name="__codelineno-36-25" href="#__codelineno-36-25"></a>                <span class="k">return</span> <span class="n">feature</span>
</span><span id="__span-36-26"><a id="__codelineno-36-26" name="__codelineno-36-26" href="#__codelineno-36-26"></a>
</span><span id="__span-36-27"><a id="__codelineno-36-27" name="__codelineno-36-27" href="#__codelineno-36-27"></a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-36-28"><a id="__codelineno-36-28" name="__codelineno-36-28" href="#__codelineno-36-28"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-36-29"><a id="__codelineno-36-29" name="__codelineno-36-29" href="#__codelineno-36-29"></a>            <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">],</span>
</span><span id="__span-36-30"><a id="__codelineno-36-30" name="__codelineno-36-30" href="#__codelineno-36-30"></a>            <span class="s2">&quot;pixelsize&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelsize</span><span class="p">,</span>
</span><span id="__span-36-31"><a id="__codelineno-36-31" name="__codelineno-36-31" href="#__codelineno-36-31"></a>            <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
</span><span id="__span-36-32"><a id="__codelineno-36-32" name="__codelineno-36-32" href="#__codelineno-36-32"></a>        <span class="p">}</span>
</span><span id="__span-36-33"><a id="__codelineno-36-33" name="__codelineno-36-33" href="#__codelineno-36-33"></a>
</span><span id="__span-36-34"><a id="__codelineno-36-34" name="__codelineno-36-34" href="#__codelineno-36-34"></a>
</span><span id="__span-36-35"><a id="__codelineno-36-35" name="__codelineno-36-35" href="#__codelineno-36-35"></a><span class="k">def</span> <span class="nf">detect_features</span><span class="p">(</span>
</span><span id="__span-36-36"><a id="__codelineno-36-36" name="__codelineno-36-36" href="#__codelineno-36-36"></a>    <span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">FibsemImage</span><span class="p">],</span>          <span class="c1"># the image to detect features in</span>
</span><span id="__span-36-37"><a id="__codelineno-36-37" name="__codelineno-36-37" href="#__codelineno-36-37"></a>    <span class="n">model</span><span class="p">:</span> <span class="n">SegmentationModel</span><span class="p">,</span>                       <span class="c1"># the segmentation model</span>
</span><span id="__span-36-38"><a id="__codelineno-36-38" name="__codelineno-36-38" href="#__codelineno-36-38"></a>    <span class="n">features</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Feature</span><span class="p">],</span>                       <span class="c1"># the list of features to detect  </span>
</span><span id="__span-36-39"><a id="__codelineno-36-39" name="__codelineno-36-39" href="#__codelineno-36-39"></a>    <span class="n">pixelsize</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>                               <span class="c1"># the pixel size of the image (used to calculate microscope coordinate conversion)</span>
</span><span id="__span-36-40"><a id="__codelineno-36-40" name="__codelineno-36-40" href="#__codelineno-36-40"></a>    <span class="nb">filter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>                            <span class="c1"># filter to the best feature, best is determined by being closest to the point. </span>
</span><span id="__span-36-41"><a id="__codelineno-36-41" name="__codelineno-36-41" href="#__codelineno-36-41"></a>                                                    <span class="c1"># false will return multiple detections each feaature</span>
</span><span id="__span-36-42"><a id="__codelineno-36-42" name="__codelineno-36-42" href="#__codelineno-36-42"></a>    <span class="n">point</span><span class="p">:</span> <span class="n">Point</span> <span class="o">=</span> <span class="kc">None</span>                             <span class="c1"># the point to use for the &#39;best&#39; feature. defaults to the centre of the image if not specified</span>
</span><span id="__span-36-43"><a id="__codelineno-36-43" name="__codelineno-36-43" href="#__codelineno-36-43"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DetectedFeatures</span><span class="p">:</span>
</span><span id="__span-36-44"><a id="__codelineno-36-44" name="__codelineno-36-44" href="#__codelineno-36-44"></a>
</span><span id="__span-36-45"><a id="__codelineno-36-45" name="__codelineno-36-45" href="#__codelineno-36-45"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">FibsemImage</span><span class="p">):</span>
</span><span id="__span-36-46"><a id="__codelineno-36-46" name="__codelineno-36-46" href="#__codelineno-36-46"></a>        <span class="n">fibsem_image</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-36-47"><a id="__codelineno-36-47" name="__codelineno-36-47" href="#__codelineno-36-47"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">data</span>
</span><span id="__span-36-48"><a id="__codelineno-36-48" name="__codelineno-36-48" href="#__codelineno-36-48"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-36-49"><a id="__codelineno-36-49" name="__codelineno-36-49" href="#__codelineno-36-49"></a>        <span class="n">fibsem_image</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-36-50"><a id="__codelineno-36-50" name="__codelineno-36-50" href="#__codelineno-36-50"></a>
</span><span id="__span-36-51"><a id="__codelineno-36-51" name="__codelineno-36-51" href="#__codelineno-36-51"></a>    <span class="c1"># model inference</span>
</span><span id="__span-36-52"><a id="__codelineno-36-52" name="__codelineno-36-52" href="#__codelineno-36-52"></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">rgb</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-36-53"><a id="__codelineno-36-53" name="__codelineno-36-53" href="#__codelineno-36-53"></a>    <span class="n">rgb</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">postprocess</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">num_classes</span><span class="p">)</span>
</span><span id="__span-36-54"><a id="__codelineno-36-54" name="__codelineno-36-54" href="#__codelineno-36-54"></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># remove channel dim</span>
</span><span id="__span-36-55"><a id="__codelineno-36-55" name="__codelineno-36-55" href="#__codelineno-36-55"></a>
</span><span id="__span-36-56"><a id="__codelineno-36-56" name="__codelineno-36-56" href="#__codelineno-36-56"></a>    <span class="c1"># detect features</span>
</span><span id="__span-36-57"><a id="__codelineno-36-57" name="__codelineno-36-57" href="#__codelineno-36-57"></a>    <span class="n">features</span> <span class="o">=</span> <span class="n">detect_features_v2</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> 
</span><span id="__span-36-58"><a id="__codelineno-36-58" name="__codelineno-36-58" href="#__codelineno-36-58"></a>                                  <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> 
</span><span id="__span-36-59"><a id="__codelineno-36-59" name="__codelineno-36-59" href="#__codelineno-36-59"></a>                                  <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> 
</span><span id="__span-36-60"><a id="__codelineno-36-60" name="__codelineno-36-60" href="#__codelineno-36-60"></a>                                  <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span> <span class="n">point</span><span class="o">=</span><span class="n">point</span><span class="p">)</span>
</span><span id="__span-36-61"><a id="__codelineno-36-61" name="__codelineno-36-61" href="#__codelineno-36-61"></a>
</span><span id="__span-36-62"><a id="__codelineno-36-62" name="__codelineno-36-62" href="#__codelineno-36-62"></a>    <span class="n">det</span> <span class="o">=</span> <span class="n">DetectedFeatures</span><span class="p">(</span>
</span><span id="__span-36-63"><a id="__codelineno-36-63" name="__codelineno-36-63" href="#__codelineno-36-63"></a>        <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="c1"># type: ignore</span>
</span><span id="__span-36-64"><a id="__codelineno-36-64" name="__codelineno-36-64" href="#__codelineno-36-64"></a>        <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
</span><span id="__span-36-65"><a id="__codelineno-36-65" name="__codelineno-36-65" href="#__codelineno-36-65"></a>        <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
</span><span id="__span-36-66"><a id="__codelineno-36-66" name="__codelineno-36-66" href="#__codelineno-36-66"></a>        <span class="n">rgb</span><span class="o">=</span><span class="n">rgb</span><span class="p">,</span>
</span><span id="__span-36-67"><a id="__codelineno-36-67" name="__codelineno-36-67" href="#__codelineno-36-67"></a>        <span class="n">pixelsize</span><span class="o">=</span><span class="n">pixelsize</span><span class="p">,</span>
</span><span id="__span-36-68"><a id="__codelineno-36-68" name="__codelineno-36-68" href="#__codelineno-36-68"></a>        <span class="n">fibsem_image</span><span class="o">=</span><span class="n">fibsem_image</span><span class="p">,</span>
</span><span id="__span-36-69"><a id="__codelineno-36-69" name="__codelineno-36-69" href="#__codelineno-36-69"></a>        <span class="n">checkpoint</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">checkpoint</span>
</span><span id="__span-36-70"><a id="__codelineno-36-70" name="__codelineno-36-70" href="#__codelineno-36-70"></a>    <span class="p">)</span>
</span><span id="__span-36-71"><a id="__codelineno-36-71" name="__codelineno-36-71" href="#__codelineno-36-71"></a>
</span><span id="__span-36-72"><a id="__codelineno-36-72" name="__codelineno-36-72" href="#__codelineno-36-72"></a>    <span class="c1"># distance in metres (from centre)</span>
</span><span id="__span-36-73"><a id="__codelineno-36-73" name="__codelineno-36-73" href="#__codelineno-36-73"></a>    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">det</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
</span><span id="__span-36-74"><a id="__codelineno-36-74" name="__codelineno-36-74" href="#__codelineno-36-74"></a>        <span class="n">feature</span><span class="o">.</span><span class="n">feature_m</span> <span class="o">=</span> <span class="n">conversions</span><span class="o">.</span><span class="n">image_to_microscope_image_coordinates</span><span class="p">(</span>
</span><span id="__span-36-75"><a id="__codelineno-36-75" name="__codelineno-36-75" href="#__codelineno-36-75"></a>            <span class="n">feature</span><span class="o">.</span><span class="n">px</span><span class="p">,</span> <span class="n">det</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">det</span><span class="o">.</span><span class="n">pixelsize</span>
</span><span id="__span-36-76"><a id="__codelineno-36-76" name="__codelineno-36-76" href="#__codelineno-36-76"></a>        <span class="p">)</span>
</span><span id="__span-36-77"><a id="__codelineno-36-77" name="__codelineno-36-77" href="#__codelineno-36-77"></a>
</span><span id="__span-36-78"><a id="__codelineno-36-78" name="__codelineno-36-78" href="#__codelineno-36-78"></a>    <span class="k">return</span> <span class="n">det</span>
</span></code></pre></div>
<p>You can also detect multiple instances of the same feature, and plot multiple detections at once.</p>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="o">%</span><span class="n">load_ext</span> <span class="n">autoreload</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="o">%</span><span class="n">autoreload</span> <span class="mi">2</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="kn">from</span> <span class="nn">fibsem.detection</span> <span class="kn">import</span> <span class="n">detection</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="kn">from</span> <span class="nn">fibsem.segmentation.model</span> <span class="kn">import</span> <span class="n">load_model</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="kn">from</span> <span class="nn">fibsem.structures</span> <span class="kn">import</span> <span class="n">FibsemImage</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="kn">from</span> <span class="nn">fibsem.detection.detection</span> <span class="kn">import</span> <span class="n">DetectedFeatures</span><span class="p">,</span> <span class="n">NeedleTip</span><span class="p">,</span> <span class="n">LamellaRightEdge</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a><span class="kn">import</span> <span class="nn">glob</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a><span class="c1"># load model</span>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a><span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;autolamella-mega-20240107.pt&quot;</span><span class="p">)</span>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a><span class="c1"># load data</span>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a><span class="n">filenames</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;data/example/ml*.tif&quot;</span><span class="p">)</span>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a><span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">detection</span><span class="o">.</span><span class="n">LamellaCentre</span><span class="p">()]</span>
</span><span id="__span-37-16"><a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a>
</span><span id="__span-37-17"><a id="__codelineno-37-17" name="__codelineno-37-17" href="#__codelineno-37-17"></a><span class="n">dets</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-37-18"><a id="__codelineno-37-18" name="__codelineno-37-18" href="#__codelineno-37-18"></a><span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
</span><span id="__span-37-19"><a id="__codelineno-37-19" name="__codelineno-37-19" href="#__codelineno-37-19"></a>
</span><span id="__span-37-20"><a id="__codelineno-37-20" name="__codelineno-37-20" href="#__codelineno-37-20"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">FibsemImage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="__span-37-21"><a id="__codelineno-37-21" name="__codelineno-37-21" href="#__codelineno-37-21"></a>
</span><span id="__span-37-22"><a id="__codelineno-37-22" name="__codelineno-37-22" href="#__codelineno-37-22"></a>    <span class="c1"># detect features (also runs segmentation inference)</span>
</span><span id="__span-37-23"><a id="__codelineno-37-23" name="__codelineno-37-23" href="#__codelineno-37-23"></a>    <span class="n">det</span><span class="p">:</span> <span class="n">DetectedFeatures</span> <span class="o">=</span> <span class="n">detection</span><span class="o">.</span><span class="n">detect_features</span><span class="p">(</span>
</span><span id="__span-37-24"><a id="__codelineno-37-24" name="__codelineno-37-24" href="#__codelineno-37-24"></a>        <span class="n">image</span><span class="o">=</span> <span class="n">image</span><span class="p">,</span> 
</span><span id="__span-37-25"><a id="__codelineno-37-25" name="__codelineno-37-25" href="#__codelineno-37-25"></a>        <span class="n">model</span><span class="o">=</span> <span class="n">model</span><span class="p">,</span> 
</span><span id="__span-37-26"><a id="__codelineno-37-26" name="__codelineno-37-26" href="#__codelineno-37-26"></a>        <span class="n">features</span> <span class="o">=</span> <span class="n">features</span><span class="p">,</span>
</span><span id="__span-37-27"><a id="__codelineno-37-27" name="__codelineno-37-27" href="#__codelineno-37-27"></a>        <span class="n">pixelsize</span> <span class="o">=</span> <span class="mf">25e-9</span><span class="p">,</span>      <span class="c1"># note: this should be from image.metadata.pixelsize typically</span>
</span><span id="__span-37-28"><a id="__codelineno-37-28" name="__codelineno-37-28" href="#__codelineno-37-28"></a>        <span class="nb">filter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
</span><span id="__span-37-29"><a id="__codelineno-37-29" name="__codelineno-37-29" href="#__codelineno-37-29"></a>        <span class="n">point</span><span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-37-30"><a id="__codelineno-37-30" name="__codelineno-37-30" href="#__codelineno-37-30"></a>    <span class="p">)</span>
</span><span id="__span-37-31"><a id="__codelineno-37-31" name="__codelineno-37-31" href="#__codelineno-37-31"></a>
</span><span id="__span-37-32"><a id="__codelineno-37-32" name="__codelineno-37-32" href="#__codelineno-37-32"></a>    <span class="n">dets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">det</span><span class="p">)</span>
</span><span id="__span-37-33"><a id="__codelineno-37-33" name="__codelineno-37-33" href="#__codelineno-37-33"></a>
</span><span id="__span-37-34"><a id="__codelineno-37-34" name="__codelineno-37-34" href="#__codelineno-37-34"></a><span class="c1"># plot detections</span>
</span><span id="__span-37-35"><a id="__codelineno-37-35" name="__codelineno-37-35" href="#__codelineno-37-35"></a><span class="n">detection</span><span class="o">.</span><span class="n">plot_detections</span><span class="p">(</span><span class="n">dets</span><span class="p">)</span>
</span></code></pre></div>
<img alt="Example Multiple Detections 01" src="../assets/api/feature_detection/example_multiple_feature_detection01.png" />
<img alt="Example Multiple Detections 02" src="../assets/api/feature_detection/example_multiple_feature_detection02.png" />
<img alt="Example Multiple Detections 03" src="../assets/api/feature_detection/example_multiple_feature_detection03.png" /></p>
<p>Multiple Feature Detection Examples</p>
<h3 id="objects-api">Objects API</h3>
<p>For more generic features, such a bounding boxes, instance masks, and keypoints, you can use the generic get_objects method. This returns are list of detected objects with bboxes, instance masks, and keypoints for each. </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1">## Example: Get Objects API</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="kn">from</span> <span class="nn">fibsem.detection</span> <span class="kn">import</span> <span class="n">detection</span> 
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="kn">from</span> <span class="nn">fibsem.segmentation.model</span> <span class="kn">import</span> <span class="n">load_model</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="kn">from</span> <span class="nn">fibsem.structures</span> <span class="kn">import</span> <span class="n">FibsemImage</span> 
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="c1"># load image</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="n">image</span> <span class="o">=</span> <span class="n">FibsemImage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/test_image.tif&quot;</span><span class="p">)</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="c1"># load mega model</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;autolamella-mega-20240107.pt&quot;</span><span class="p">)</span>
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="c1"># run model inference</span>
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="n">mask</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">rgb</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a>
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a><span class="c1"># get all objects</span>
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a><span class="n">objects</span> <span class="o">=</span> <span class="n">detection</span><span class="o">.</span><span class="n">get_objects</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
</span><span id="__span-38-19"><a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a>
</span><span id="__span-38-20"><a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a><span class="c1"># plot bounding boxes</span>
</span><span id="__span-38-21"><a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a><span class="n">fig</span> <span class="o">=</span> <span class="n">detection</span><span class="o">.</span><span class="n">plot_bounding_boxes</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">objects</span><span class="p">)</span>
</span></code></pre></div>
<p><img alt="Bounding Box Example 00" src="../assets/api/feature_detection/example_bounding_boxes00.png" />
Bounding Boxes Example</p>
<h2 id="machine-learning-data-engine">Machine Learning Data Engine</h2>
<p>We have implemented a data engine into the AutoLamella program. This data engine enables efficient model improvement across a wide range of tasks by using human feedback, and a set of model enhanced tools. Moreover, the data engine allows the models to improve faster, and more efficiently as they improve in performance by using the models to label data and generate test sets.</p>
<p>[DATA ENGINE IMAGE]</p>
<h3 id="data-collection">Data Collection</h3>
<p>When running AutoLamella, we automatically save the images, masks and keypoint detections from the machine learning systems. In addition, any image can be manually added to the dataset, but will have to be manually pre-processed to conform. By default, machine learning data (images, masks, keypoints) are saved to the fibsem/log/data/ml directory.</p>
<h3 id="data-curation">Data Curation</h3>
<p>In order to efficiently improve the model, as well as automatically generate test datasets we implemented an active learning system into the user interface. When running AutoLamella in <a href="#supervised-mode">Supervised Mode</a>, the user has the opportunity to correct the keypoint detections produced by the model. We log this intervention, and flag that image to be added to the training dataset. Images that the model gets correct are also logged, and added to the test dataset.</p>
<p>This form of active learning allows us to collect images that the model is currently failing on, and not feed it any more of images that it already succeeds at. This is crucical to balance the dataset, and efficiently improve when the dataset is relative small (~100s of images).</p>
<p>For more details on this approach to data curation, please see <a href="../../autolamella/ml/">AutoLamella Datasets and Models</a></p>
<h3 id="data-labelling">Data Labelling</h3>
<p>We developed a napari plugin for labelling images for semantic segmentation. The plugin supports three complementary labelling modes; manual labelling, model assisted labelling and sam assisted labelling.</p>
<p>[Image Labelling Napari Plugin][Example Labelling GIF for each mode]</p>
<p>For details about how this was used, please see <a href="../../autolamella/ml/">AutoLamella Datasets and Models</a></p>
<h3 id="manual-labelling">Manual Labelling</h3>
<p>The default mode is manual labelling, which enables the use the napari paint tools to manually label images. The manual labelling mode is also used to edit or 'touch up' model generated labels.</p>
<p>The user can define the segmentation labels and colors used by editing the fibsem/segementation/segmentation_config.yaml file.  </p>
<h3 id="model-assisted-labelling">Model Assisted Labelling</h3>
<p>The model assisted labelling tool allows you to use a trained model to assist in the labelling of new data. This is useful for labelling large datasets. The model will make a prediction and the user can correct the prediction using the same drawing tools.</p>
<p>To use, go to the Model tab and load your model, and then tick 'model assisted' to enable the model assisted labelling.</p>
<h3 id="segmentanything-assisted-labelling">SegmentAnything Assisted Labelling</h3>
<p>We have implemented the Segment Anything Model from MetaAI. This model is trained to segment any object. Here we use it as part of the model assisted labelling. We currently support the huggingface transformers implementation for SAM. You can use any compatible SAM model.</p>
<p>The recommended models are:</p>
<ul>
<li>Large GPU: facebook/sam-vit-base or facebook/sam-vit-large</li>
<li>Small GPU / CPU: Zigeng/SlimSAM-uniform-50</li>
</ul>
<p>Instructions for using SAM assisted labelling are shown in the side panel.</p>
<h3 id="model-training">Model Training</h3>
<p>Model training is relatively simple, and by default we use models from the segmentation-models-pytorch package for the implementation.</p>
<h4 id="data-augmentation">Data Augmentation</h4>
<p>Data is augmented with standard data augmentation methods that are suitable for electron microscope data.</p>
<p>We currently use; random rotation, random horizontal / vertical flip, random autocontrast, random equalize, gaussian blue and color jitter.</p>
<h4 id="losses-optimiser">Losses, Optimiser</h4>
<p>We use a standard Adam optimiser, and multi-loss (cross-entropy, dice, and focal)</p>
<h4 id="training-the-model">Training the Model</h4>
<p>To train the model:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>python<span class="w"> </span>fibsem/segementation/train.py<span class="w"> </span>--config<span class="w"> </span>training-config.yaml
</span></code></pre></div>
<p>Example Model Training Config</p>
<div class="language-yaml highlight"><span class="filename">training-config.yaml</span><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1"># data</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="nt">data_paths</span><span class="p">:</span><span class="w">  </span><span class="p p-Indicator">[</span><span class="nv">/path/to/data</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">/path/to/second/data</span><span class="p p-Indicator">]</span><span class="w">                  </span><span class="c1"># paths to image data (multiple supported)</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="nt">label_paths</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">/path/to/data/labels</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">/path/to/second/data/labels</span><span class="p p-Indicator">]</span><span class="w">    </span><span class="c1"># paths to label data (multiple supported)</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="nt">save_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/save/checkpoints</span><span class="w">                                </span><span class="c1"># path to save checkpoints (checkpointed each epoch)</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="nt">checkpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w">                                                    </span><span class="c1"># checkpoint to resume from</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="c1"># model</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="nt">encoder</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;resnet34&quot;</span><span class="w">                             </span><span class="c1"># segmentation model encoder (imagenet)</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="nt">num_classes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span><span class="w">                                  </span><span class="c1"># number of classes</span>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="c1"># training</span>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="nt">epochs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span><span class="w">                                      </span><span class="c1"># number of epochs</span>
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="nt">split</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span><span class="w">                                      </span><span class="c1"># train / val split</span>
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w">                                   </span><span class="c1"># batch size</span>
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a><span class="nt">lr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.0e-4</span><span class="w">                                      </span><span class="c1"># initial learning rate</span>
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a>
</span><span id="__span-40-17"><a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a><span class="c1"># logging</span>
</span><span id="__span-40-18"><a id="__codelineno-40-18" name="__codelineno-40-18" href="#__codelineno-40-18"></a><span class="nt">train_log_freq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32</span><span class="w">                              </span><span class="c1"># frequency to log training images</span>
</span><span id="__span-40-19"><a id="__codelineno-40-19" name="__codelineno-40-19" href="#__codelineno-40-19"></a><span class="nt">val_log_freq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32</span><span class="w">                                </span><span class="c1"># frequency to log validation images</span>
</span><span id="__span-40-20"><a id="__codelineno-40-20" name="__codelineno-40-20" href="#__codelineno-40-20"></a>
</span><span id="__span-40-21"><a id="__codelineno-40-21" name="__codelineno-40-21" href="#__codelineno-40-21"></a><span class="c1"># wandb</span>
</span><span id="__span-40-22"><a id="__codelineno-40-22" name="__codelineno-40-22" href="#__codelineno-40-22"></a><span class="nt">wandb</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">                                     </span><span class="c1"># enable wandb logging</span>
</span><span id="__span-40-23"><a id="__codelineno-40-23" name="__codelineno-40-23" href="#__codelineno-40-23"></a><span class="nt">wandb_project</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;autolamella-mega&quot;</span><span class="w">               </span><span class="c1"># wandb project</span>
</span><span id="__span-40-24"><a id="__codelineno-40-24" name="__codelineno-40-24" href="#__codelineno-40-24"></a><span class="nt">wandb_entity</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;openfibsem&quot;</span><span class="w">                      </span><span class="c1"># wandb user / org</span>
</span><span id="__span-40-25"><a id="__codelineno-40-25" name="__codelineno-40-25" href="#__codelineno-40-25"></a><span class="nt">model_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mega-model&quot;</span><span class="w">                        </span><span class="c1"># model type note (descriptive only)</span>
</span><span id="__span-40-26"><a id="__codelineno-40-26" name="__codelineno-40-26" href="#__codelineno-40-26"></a><span class="nt">note</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;notes</span><span class="nv"> </span><span class="s">about</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">specific</span><span class="nv"> </span><span class="s">training</span><span class="nv"> </span><span class="s">run&quot;</span><span class="w">  </span><span class="c1"># additional trianing note (descriptive only)</span>
</span></code></pre></div>
<h4 id="external-integration-nnunet">External Integration - NNUnet</h4>
<p>NNUnet is a popular library for training segmentation models. We provide a set of converters for converting datasets to the nnunet format, and converting nnunet models to compatible openfibsem formats.</p>
<p>Script to convert data labelled with OpenFIBSEM to NNUnet format.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>python<span class="w"> </span>scripts/convert_to_nnunet_dataset.py<span class="w"> </span>-h
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>--data_path:<span class="w"> </span>the<span class="w"> </span>path<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>images<span class="w"> </span>directory<span class="w"> </span><span class="o">(</span><span class="nb">source</span><span class="o">)</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>--label_path:<span class="w">  </span>the<span class="w"> </span>path<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>labels<span class="w"> </span>directory<span class="w"> </span><span class="o">(</span><span class="nb">source</span><span class="o">)</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>--nnunet_data_path:<span class="w"> </span>the<span class="w"> </span>path<span class="w"> </span>to<span class="w"> </span>nnunet<span class="w"> </span>data<span class="w"> </span>directory<span class="w"> </span><span class="o">(</span>destination<span class="o">)</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>--label_map<span class="w"> </span>:<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>label<span class="w"> </span>names<span class="w"> </span><span class="o">(</span>text<span class="w"> </span>file<span class="o">)</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>--filetype:<span class="w"> </span>the<span class="w"> </span>file<span class="w"> </span>extension<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>images<span class="w"> </span>/<span class="w"> </span>labels<span class="w"> </span><span class="o">(</span>.tif<span class="w"> </span><span class="k">for</span><span class="w"> </span>fibsem<span class="o">)</span>
</span></code></pre></div>
<p>Script to convert nnunet trained model directory to checkpoint</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>python<span class="w"> </span>scripts/export_nnunet_checkpoint.py<span class="w"> </span>-h
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>--path:<span class="w"> </span>path<span class="w"> </span>to<span class="w"> </span>nnunet<span class="w"> </span>model<span class="w"> </span>directory<span class="w"> </span><span class="o">(</span><span class="nb">source</span><span class="o">)</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>--checkpoint_path:<span class="w"> </span>the<span class="w"> </span>path<span class="w"> </span>to<span class="w"> </span>save<span class="w"> </span>the<span class="w"> </span>output<span class="w"> </span>checkpoint
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>--checkpoint_name:<span class="w"> </span>the<span class="w"> </span>filename<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>output<span class="w"> </span>checkpoint<span class="w"> </span>
</span></code></pre></div>
<p>Make sure you save your checkpoint with 'nnunet' in the name so the load_model helper can automatically load it:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="kn">from</span> <span class="nn">fibsem.segementation.model</span> <span class="kn">import</span> <span class="n">load_model</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="c1"># load nnunet model checkpoint</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s1">&#39;my-nnunet-model-checkpoint.pt&#39;</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="external-integration-onnx">External Integration - ONNX</h4>
<p>ONNX (Open Neural Network Exchange) is standardised format for machine learning models. We provide a script to convert trained models to onnx format. ONNX models are much more portable, and don't require the dependency on pytorch to run.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>python<span class="w"> </span>scripts/convert_to_onnx.py<span class="w"> </span>-h
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>--checkpoint:<span class="w"> </span>path<span class="w"> </span>to<span class="w"> </span>openfibsem<span class="w"> </span>model<span class="w"> </span>checkpoint
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>--output:<span class="w"> </span>path<span class="w"> </span>to<span class="w"> </span>save<span class="w"> </span>onnx<span class="w"> </span>checkpoint
</span></code></pre></div>
<p>Code to load onnx model in openfibsem</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="kn">from</span> <span class="nn">fibsem.segmentation.model</span> <span class="kn">import</span> <span class="n">load_model</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="c1"># load onnx model</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;my-model-checkpoint.onnx&quot;</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="model-evaluation">Model Evaluation</h3>
<h3 id="keypoint-labelling">Keypoint Labelling</h3>
<p>We provide a Keypoint Labelling Napari Plugin that can be used to label or edit keypoint labels generated by openfibsem. You can start from an empty directory of images, or load a csv containing the keypoint detections. The keypoints are used to evaluate the model as if it were being used online.</p>
<p>When you run AutoLamella, these keypoints used for detections are automatically logged, ready be used for evaluation.</p>
<h3 id="keypoint-evaluation">Keypoint Evaluation</h3>
<p>We provide evaluation tools for evaluating the perform of a number of different models on the keypoint detection task.</p>
<p>The evaluation will run each model checkpoint through the detection pipeline, save the results and compare them to the ground truth labels provided. Each indivudal image can be plotted, as well as the full evaluation statistics. This evaluation pipeline is useful for checking model improvement and preventing regressions on previously successful tasks.</p>
<p>To run the evaluation:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="n">python</span> <span class="n">fibsem</span><span class="o">/</span><span class="n">detection</span><span class="o">/</span><span class="n">run_evaluation</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">config</span> <span class="n">config</span><span class="o">.</span><span class="n">yaml</span>
</span></code></pre></div>
<p>Example Evaluation Configuration</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="nt">data_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;path/to/data/keypoints.csv&quot;</span><span class="w">     </span><span class="c1"># test data csv (keypoints)</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="nt">images_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;path/to/data&quot;</span><span class="w">                 </span><span class="c1"># test data image directory</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="nt">save_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;path/to/results&quot;</span><span class="w">                </span><span class="c1"># save path for evaluation results</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="nt">checkpoints</span><span class="p">:</span><span class="w"> </span><span class="c1"># list of checkpoints to evaluate</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">checkpoint</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;checkpoint-01.pt&quot;</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">checkpoint</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;checkpoint-02.pt&quot;</span>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="nt">thresholds</span><span class="p">:</span><span class="w"> </span><span class="c1"># pixel thresholds for &#39;matched&#39; keypoints</span>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">250</span>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span>
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25</span>
</span><span id="__span-47-14"><a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</span><span id="__span-47-15"><a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a>
</span><span id="__span-47-16"><a id="__codelineno-47-16" name="__codelineno-47-16" href="#__codelineno-47-16"></a><span class="c1"># options</span>
</span><span id="__span-47-17"><a id="__codelineno-47-17" name="__codelineno-47-17" href="#__codelineno-47-17"></a><span class="nt">run_eval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w">          </span><span class="c1"># run the evaluation</span>
</span><span id="__span-47-18"><a id="__codelineno-47-18" name="__codelineno-47-18" href="#__codelineno-47-18"></a><span class="nt">plot_eval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w">         </span><span class="c1"># plot the evaluation</span>
</span><span id="__span-47-19"><a id="__codelineno-47-19" name="__codelineno-47-19" href="#__codelineno-47-19"></a>
</span><span id="__span-47-20"><a id="__codelineno-47-20" name="__codelineno-47-20" href="#__codelineno-47-20"></a><span class="nt">show_det_plot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class="w">    </span><span class="c1"># show the individual keypoint detection plots</span>
</span><span id="__span-47-21"><a id="__codelineno-47-21" name="__codelineno-47-21" href="#__codelineno-47-21"></a><span class="nt">save_det_plot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w">     </span><span class="c1"># save the indivudial keypoint detection plots</span>
</span><span id="__span-47-22"><a id="__codelineno-47-22" name="__codelineno-47-22" href="#__codelineno-47-22"></a><span class="nt">show_eval_plot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class="w">   </span><span class="c1"># show the complete evaluation plots</span>
</span><span id="__span-47-23"><a id="__codelineno-47-23" name="__codelineno-47-23" href="#__codelineno-47-23"></a><span class="nt">save_eval_plot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w">    </span><span class="c1"># save the complete evaluation plots</span>
</span></code></pre></div>
<h3 id="model-deployment">Model Deployment</h3>
<p>We provide a number of generic segmentation model interfaces. We currently support the following model backends:
backend = "smp" (default), "nnunet", "onnx"</p>
<p>The load model function will automatically check which backend to use based off the name of the checkpoint. The overall generality of this model interface will be improved in the future.</p>
<p>Code</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="kn">from</span> <span class="nn">fibsem.segmentation.model</span> <span class="kn">import</span> <span class="n">load_model</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="c1"># load smp model</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;my-model-checkpoint.pt&quot;</span><span class="p">)</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="c1"># load onnx model</span>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;my-model-checkpoint.onnx&quot;</span><span class="p">)</span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="c1"># load nnunet model</span>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;my-nnunet-model-checkpoint.pt&quot;</span><span class="p">)</span>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a>
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a><span class="c1"># explictly set backend</span>
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a><span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;my-nnunet-model-checkpoint.pt&quot;</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;nnunet&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>AutoLamella checkpoints are available via huggingface (patrickcleeve/autolamella), and can be selected in the protocol tab in AutoLamella. </p>
<h2 id="user-interface">User Interface</h2>
<p>Each application has an associated user interface to allow the user to easily setup and monitor the workflow.</p>
<p>Applications: </p>
<ul>
<li>OpenFIBSEM UI:  General FIBSEM control user interface.</li>
<li>AutoLamella UI: On Grid lamella preparataion workflows</li>
<li>AutoLiftout UI: Liftout based lamella preparation workflows (NB: this will be merged with AutoLamella UI in the near future)</li>
</ul>
<p>Each user interface is implemented in napari and pyqt5. To launch the applications and plugins through napari see <a href="#napari-plugins">napari plugins</a> section.</p>
<h3 id="user-interface-controls">User Interface Controls</h3>
<p>The following standard controls are used in all applications.</p>
<h4 id="movement-controls">Movement Controls</h4>
<p>When interacting with the imaging displays, the follow controls are supported.</p>
<ul>
<li>Double Left Click: Move the stage to the selected position (Stable Move)</li>
<li>Alt + Double Left Click: Move the stage to the selected position (Vertical Move). Only supported in Ion Beam.</li>
<li>Shift + Left Click: Move the selected milling pattern to the position. Only supported in the Ion Beam.</li>
<li>Ctrl + Shift + Left Click: Move all milling patterns to the position. Only supported in the Ion Beam.</li>
</ul>
<h4 id="keypoint-controls">Keypoint Controls</h4>
<p>The following controls are supported when interacting with keypoints. 
Select Keypoint: Click on keypoint
Move Keypoint: Select and drag keypoint</p>
<h3 id="user-interface-widgets">User Interface Widgets</h3>
<p>We developed a set of ui widgets that are reused across applications.</p>
<h4 id="microscope-connection-widget">Microscope Connection Widget</h4>
<p>This widget allows the user to connect to the microscope, and configure the system.</p>
<h4 id="imaging-widget">Imaging Widget</h4>
<p>This widget allows the user to acquire images, adjust imaging parameters and use tools (e.g. ruler).</p>
<h4 id="movement-widget">Movement Widget</h4>
<p>This widget allows the user to move the stage, and save positions.</p>
<h4 id="milling-widget">Milling Widget</h4>
<p>This widget allows the user to draw milling patterns, adjust parameters, setup milling operations and run milling.</p>
<h4 id="manipulator-widget">Manipulator Widget</h4>
<p>This widget allows the user to control the manipulator.</p>
<h4 id="feature-detection-widget">Feature Detection Widget</h4>
<p>This widget allows the user to supervise the keypoint detections during a workflow, and correct them if required. </p>
<h4 id="minimap-widget">Minimap Widget</h4>
<p>This widget allows the user to use the minimap, which supports tiled imaging, low magnifcation navigation and lamella position selection. </p>
<h3 id="user-inferface-tools">User Inferface Tools</h3>
<h4 id="cryo-deposition">Cryo Deposition</h4>
<p>You can access the cryo deposition tool via the Tools menu of AutoLamella / AutoLiftout.</p>
<h4 id="sputter-coating_1">Sputter Coating</h4>
<p>Not Yet Available</p>
<h4 id="manipulator-tools">Manipulator Tools</h4>
<p>You can access the manipulator calibration and preparation tools via the Tools menu of AutoLiftout. </p>
<h3 id="supervised-mode">Supervised Mode</h3>
<p>Supervised mode can be enabled in AutoLamella. In the mode the software will pause and wait for user feedback / confirmation at specific points in the workflow. This enables the user to supervise the process, fix any mistakes, and have the software execute the rest of the workflow.  </p>
<h4 id="feature-detection_1">Feature Detection</h4>
<p>In supervised mode, the software will pause after making a keypoint detection, and ask the user to confirm. The user can move the keypoint to the correct position, and continue with the workflow. The updated keypoint will be used in the workflow, and the correction data will be logged for later use in the data engine (see below).</p>
<h4 id="milling-operations">Milling Operations</h4>
<p>In supervised mode, the software will pause before performing a milling operation, and ask the user to confirm the milling operations. The user can move the pattern, adjust the parameters and repeat the milling operations mulitple times. If not in supervised mode, milling operations are completed automatically.</p>
<h4 id="additional">Additional</h4>
<p>In supervised mode, the software will also pause and ask for confirmation at other specific steps. For example, the when running liftout methods, the software will ask the user to confirm the lamella has made contact with the post. If they confirm, the software continues with the workflow, if not the final landing procedure is repeated until the lamella lands correctly. </p>
<h3 id="napari-plugins">Napari Plugins</h3>
<p>To enable access to the user interfaces, and plugins directly through napari, please install the openfibsem napari plugin (napari-openfibsem).</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>pip<span class="w"> </span>install<span class="w"> </span>napari-openfibsem
</span></code></pre></div>
<p>This allows the user to access the Applications (OpenFIBSEM UI, AutoLamella UI, AutoLiftout UI) and Plugins (Imaging Labelling, Keypoint Labelling) directly through the plugin interface. </p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.expand", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.indexes", "content.code.copy"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>